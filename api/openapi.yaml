openapi: 3.1.0
info:
  description: "\nAPI REST pour la facturation √©lectronique en France : Factur-X,\
    \ AFNOR PDP/PA, signatures √©lectroniques.\n\n## üéØ Fonctionnalit√©s principales\n\
    \n### üìÑ G√©n√©ration de factures Factur-X\n- **Formats** : XML seul ou PDF/A-3\
    \ avec XML embarqu√©\n- **Profils** : MINIMUM, BASIC, EN16931, EXTENDED\n- **Normes**\
    \ : EN 16931 (directive UE 2014/55), ISO 19005-3 (PDF/A-3), CII (UN/CEFACT)\n\
    - **üÜï Format simplifi√©** : G√©n√©ration √† partir de SIRET + auto-enrichissement\
    \ (API Chorus Pro + Recherche Entreprises)\n\n### ‚úÖ Validation et conformit√©\n\
    - **Validation XML** : Schematron (45 √† 210+ r√®gles selon profil)\n- **Validation\
    \ PDF** : PDF/A-3, m√©tadonn√©es XMP Factur-X, signatures √©lectroniques\n- **VeraPDF**\
    \ : Validation stricte PDF/A (146+ r√®gles ISO 19005-3)\n- **Traitement asynchrone**\
    \ : Support Celery pour validations lourdes (VeraPDF)\n\n### üì° Int√©gration AFNOR\
    \ PDP/PA (XP Z12-013)\n- **Soumission de flux** : Envoi de factures vers Plateformes\
    \ de D√©mat√©rialisation Partenaires\n- **Recherche de flux** : Consultation des\
    \ factures soumises\n- **T√©l√©chargement** : R√©cup√©ration des PDF/A-3 avec XML\n\
    - **Directory Service** : Recherche d'entreprises (SIREN/SIRET)\n- **Multi-client**\
    \ : Support de plusieurs configs PDP par utilisateur (stored credentials ou zero-storage)\n\
    \n### ‚úçÔ∏è Signature √©lectronique PDF\n- **Standards** : PAdES-B-B, PAdES-B-T (horodatage\
    \ RFC 3161), PAdES-B-LT (archivage long terme)\n- **Niveaux eIDAS** : SES (auto-sign√©\
    ), AdES (CA commerciale), QES (PSCO)\n- **Validation** : V√©rification int√©grit√©\
    \ cryptographique et certificats\n- **G√©n√©ration de certificats** : Certificats\
    \ X.509 auto-sign√©s pour tests\n\n### üîÑ Traitement asynchrone\n- **Celery** :\
    \ G√©n√©ration, validation et signature asynchrones\n- **Polling** : Suivi d'√©tat\
    \ via `/taches/{id_tache}/statut`\n- **Pas de timeout** : Id√©al pour gros fichiers\
    \ ou validations lourdes\n\n## üîí Authentification\n\nToutes les requ√™tes n√©cessitent\
    \ un **token JWT** dans le header Authorization :\n```\nAuthorization: Bearer\
    \ YOUR_JWT_TOKEN\n```\n\n### Comment obtenir un token JWT ?\n\n#### üîë M√©thode\
    \ 1 : API `/api/token/` (Recommand√©e)\n\n**URL :** `https://www.factpulse.fr/api/token/`\n\
    \nCette m√©thode est **recommand√©e** pour l'int√©gration dans vos applications et\
    \ workflows CI/CD.\n\n**Pr√©requis :** Avoir d√©fini un mot de passe sur votre compte\n\
    \n**Pour les utilisateurs inscrits via email/password :**\n- Vous avez d√©j√† un\
    \ mot de passe, utilisez-le directement\n\n**Pour les utilisateurs inscrits via\
    \ OAuth (Google/GitHub) :**\n- Vous devez d'abord d√©finir un mot de passe sur\
    \ : https://www.factpulse.fr/accounts/password/set/\n- Une fois le mot de passe\
    \ cr√©√©, vous pourrez utiliser l'API\n\n**Exemple de requ√™te :**\n```bash\ncurl\
    \ -X POST https://www.factpulse.fr/api/token/ \\\n  -H \"Content-Type: application/json\"\
    \ \\\n  -d '{\n    \"username\": \"votre_email@example.com\",\n    \"password\"\
    : \"votre_mot_de_passe\"\n  }'\n```\n\n**Param√®tre optionnel `client_uid` :**\n\
    \nPour s√©lectionner les credentials d'un client sp√©cifique (PA/PDP, Chorus Pro,\
    \ certificats de signature), ajoutez `client_uid` :\n\n```bash\ncurl -X POST https://www.factpulse.fr/api/token/\
    \ \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"username\": \"\
    votre_email@example.com\",\n    \"password\": \"votre_mot_de_passe\",\n    \"\
    client_uid\": \"550e8400-e29b-41d4-a716-446655440000\"\n  }'\n```\n\nLe `client_uid`\
    \ sera inclus dans le JWT et permettra √† l'API d'utiliser automatiquement :\n\
    - Les credentials AFNOR/PDP configur√©s pour ce client\n- Les credentials Chorus\
    \ Pro configur√©s pour ce client\n- Les certificats de signature √©lectronique configur√©\
    s pour ce client\n\n**R√©ponse :**\n```json\n{\n  \"access\": \"eyJ0eXAiOiJKV1QiLCJhbGc...\"\
    ,  // Token d'acc√®s (validit√©: 30 min)\n  \"refresh\": \"eyJ0eXAiOiJKV1QiLCJhbGc...\"\
    \  // Token de rafra√Æchissement (validit√©: 7 jours)\n}\n```\n\n**Avantages :**\n\
    - ‚úÖ Automatisation compl√®te (CI/CD, scripts)\n- ‚úÖ Gestion programmatique des tokens\n\
    - ‚úÖ Support du refresh token pour renouveler automatiquement l'acc√®s\n- ‚úÖ Int√©\
    gration facile dans n'importe quel langage/outil\n\n#### üñ•Ô∏è M√©thode 2 : G√©n√©\
    ration via Dashboard (Alternative)\n\n**URL :** https://www.factpulse.fr/dashboard/\n\
    \nCette m√©thode convient pour des tests rapides ou une utilisation occasionnelle\
    \ via l'interface graphique.\n\n**Fonctionnement :**\n- Connectez-vous au dashboard\n\
    - Utilisez les boutons \"Generate Test Token\" ou \"Generate Production Token\"\
    \n- Fonctionne pour **tous** les utilisateurs (OAuth et email/password), sans\
    \ n√©cessiter de mot de passe\n\n**Types de tokens :**\n- **Token Test** : Validit√©\
    \ 24h, quota 1000 appels/jour (gratuit)\n- **Token Production** : Validit√© 7 jours,\
    \ quota selon votre forfait\n\n**Avantages :**\n- ‚úÖ Rapide pour tester l'API\n\
    - ‚úÖ Aucun mot de passe requis\n- ‚úÖ Interface visuelle simple\n\n**Inconv√©nients\
    \ :**\n- ‚ùå N√©cessite une action manuelle\n- ‚ùå Pas de refresh token\n- ‚ùå Moins\
    \ adapt√© pour l'automatisation\n\n### üìö Documentation compl√®te\n\nPour plus d'informations\
    \ sur l'authentification et l'utilisation de l'API :\nhttps://www.factpulse.fr/documentation-api/\n\
    \    "
  title: API REST FactPulse
  version: 1.0.0
servers:
- url: /
tags:
- description: "\n## üìÑ G√©n√©ration et validation de factures √©lectroniques\n\n**API\
    \ principale pour la g√©n√©ration de factures Factur-X conformes aux normes europ√©\
    ennes.**\n\n### Fonctionnalit√©s\n\n- **G√©n√©ration Factur-X** : Profils MINIMUM,\
    \ BASIC, EN16931, EXTENDED\n- **Validation** : Schematron (45 √† 210+ r√®gles),\
    \ VeraPDF (146+ r√®gles PDF/A-3)\n- **Signature √©lectronique** : PAdES-B-B, PAdES-B-T,\
    \ PAdES-B-LT (niveaux eIDAS)\n- **Traitement asynchrone** : Support Celery pour\
    \ gros fichiers\n- **Auto-enrichissement** : Donn√©es depuis Chorus Pro + API Entreprise\n\
    \        "
  name: Traitement Facture
- description: "\n## üîë Authentification OAuth2 pour AFNOR PDP\n\n**Endpoint pour\
    \ obtenir un token OAuth2 pour l'authentification aupr√®s des Plateformes de D√©\
    mat√©rialisation Partenaires.**\n\n### Utilisation\n\nCet endpoint permet d'obtenir\
    \ un access token OAuth2 n√©cessaire pour appeler les API Flow Service et Directory\
    \ Service.\n\n**Type de requ√™te** : `application/x-www-form-urlencoded`\n\n**Param√®\
    tres** :\n- `grant_type` : `client_credentials` (requis)\n- `client_id` : ID client\
    \ fourni par le PDP (requis)\n- `client_secret` : Secret client fourni par le\
    \ PDP (requis)\n\n**R√©ponse** :\n```json\n{\n  \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\
    ,\n  \"token_type\": \"Bearer\",\n  \"expires_in\": 3600\n}\n```\n\n**Note** :\
    \ Ce token doit √™tre utilis√© dans le header `Authorization: Bearer {access_token}`\
    \ pour les appels aux API AFNOR.\n        "
  name: AFNOR PDP/PA
- description: "\n## üîê Modes d'authentification AFNOR PDP\n\n**Tous les endpoints\
    \ AFNOR Flow Service supportent 2 modes d'authentification :**\n\n### Mode 1 :\
    \ Stock√© (Stored Credentials)\n- Les credentials PDP sont stock√©es chiffr√©es dans\
    \ Django\n- R√©cup√©r√©es automatiquement via le `client_uid` du JWT\n- **Django\
    \ d√©cide** de l'environnement (test/production via les URLs configur√©es)\n- Pratique\
    \ pour la production\n\n**Exemple** :\n```json\n{\n  \"name\": \"Facture FAC-2025-001\"\
    ,\n  \"flowSyntax\": \"CII\",\n  \"flowProfile\": \"EN16931\"\n}\n```\n\n**JWT\
    \ doit contenir** : claim `client_uid` pointant vers une config PDP enregistr√©\
    e\n\n---\n\n### Mode 2 : Zero-Trust (Zero-Storage)\n- Les credentials PDP sont\
    \ pass√©es dans le champ `pdp_credentials` de chaque requ√™te\n- Jamais stock√©es\
    \ en base de donn√©es\n- **Le client d√©cide** de l'environnement via les URLs dans\
    \ les credentials\n- S√©curit√© maximale, conformit√© RGPD\n\n**Exemple** :\n```json\n\
    {\n  \"name\": \"Facture FAC-2025-001\",\n  \"flowSyntax\": \"CII\",\n  \"flowProfile\"\
    : \"EN16931\",\n  \"pdp_credentials\": {\n    \"flow_service_url\": \"https://pdp-production.example.fr/flow/v1\"\
    ,\n    \"token_url\": \"https://auth.example.fr/oauth/token\",\n    \"client_id\"\
    : \"client_prod_123\",\n    \"client_secret\": \"secret_prod_456\",\n    \"directory_service_url\"\
    : \"https://pdp-production.example.fr/directory/v1\"\n  }\n}\n```\n\n---\n\n**Sch√©\
    ma PDPCredentials** :\n- `flow_service_url` : URL de l'API Flow Service (soumission/recherche\
    \ de factures)\n- `token_url` : URL OAuth2 pour obtenir le token\n- `client_id`\
    \ : Client ID OAuth2 fourni par le PDP\n- `client_secret` : Client Secret OAuth2\
    \ fourni par le PDP\n- `directory_service_url` : (Optionnel) URL de l'API Directory\
    \ Service (annuaire)\n\n**Note** : Tous les endpoints ci-dessous supportent ces\
    \ 2 modes. Le champ `pdp_credentials` est optionnel dans chaque requ√™te.\n\nüìñ\
    \ **Documentation compl√®te** : Voir `OPENAPI_AUTHENTICATION_MODES.md`\n      \
    \  "
  name: AFNOR PDP/PA - Flow Service
- description: "\n## üîê Modes d'authentification AFNOR Directory Service\n\nSupporte\
    \ les **m√™mes 2 modes d'authentification** que Flow Service.\n\n### Mode 1 : Stock√©\
    \nJWT avec `client_uid` ‚Üí Credentials r√©cup√©r√©es depuis Django\n\n### Mode 2 :\
    \ Zero-Trust\nCredentials PDP pass√©es dans `pdp_credentials` (voir Flow Service)\n\
    \nüìñ **Documentation compl√®te** : Voir tag \"AFNOR PDP/PA - Flow Service\" ci-dessus\n\
    \        "
  name: AFNOR PDP/PA - Directory Service
- description: "\n## üîê Modes d'authentification Signature √©lectronique\n\n**Tous\
    \ les endpoints de signature √©lectronique supportent 2 modes d'authentification\
    \ :**\n\n### Mode 1 : Stock√© (Stored Credentials)\n- Les certificats de signature\
    \ sont stock√©s chiffr√©s dans Django\n- R√©cup√©r√©s automatiquement via le `client_uid`\
    \ du JWT\n- **Django d√©cide** de l'environnement (certificat test ou qualifi√©\
    \ eIDAS)\n- Pratique pour la production\n\n**Exemple** :\n```json\n{\n  \"pdf_base64\"\
    : \"JVBERi0xLjQKJeLjz9MK...\",\n  \"filename\": \"facture.pdf\",\n  \"signature_reason\"\
    : \"Facture officielle\",\n  \"signature_location\": \"Paris, France\",\n  \"\
    contact_info\": \"contact@entreprise.fr\"\n}\n```\n\n**JWT doit contenir** : claim\
    \ `client_uid` pointant vers un certificat enregistr√©\n\n---\n\n### Mode 2 : Zero-Trust\n\
    - Les credentials du certificat sont pass√©es dans le champ `certificate_credentials`\
    \ de chaque requ√™te\n- Jamais stock√©es en base de donn√©es\n- **Le client d√©cide**\
    \ du type de certificat (test ou qualifi√© eIDAS)\n- S√©curit√© maximale, conformit√©\
    \ RGPD\n\n**Exemple** :\n```json\n{\n  \"certificate_credentials\": {\n    \"\
    certificate_base64\": \"MIIE...\",\n    \"private_key_base64\": \"MIIE...\",\n\
    \    \"password\": \"cert_password\",\n    \"timestamp_url\": \"http://timestamp.digicert.com\"\
    ,\n    \"use_qualified_certificate\": true\n  },\n  \"pdf_base64\": \"JVBERi0xLjQKJeLjz9MK...\"\
    ,\n  \"filename\": \"facture.pdf\",\n  \"signature_reason\": \"Facture officielle\"\
    ,\n  \"signature_location\": \"Paris, France\",\n  \"contact_info\": \"contact@entreprise.fr\"\
    \n}\n```\n\n---\n\n**Sch√©ma CertificateCredentials** :\n- `certificate_base64`\
    \ : Certificat X.509 encod√© en base64\n- `private_key_base64` : Cl√© priv√©e encod√©\
    e en base64\n- `password` : Mot de passe de la cl√© priv√©e (si chiffr√©e)\n- `timestamp_url`\
    \ : URL du serveur d'horodatage (TSA)\n- `use_qualified_certificate` : `true`\
    \ = certificat qualifi√© eIDAS, `false` = certificat test\n\n**Note** : Tous les\
    \ endpoints ci-dessous supportent ces 2 modes. Le champ `certificate_credentials`\
    \ est optionnel dans chaque requ√™te.\n\nüìñ **Documentation compl√®te** : Voir `OPENAPI_AUTHENTICATION_MODES.md`\n\
    \        "
  name: Signature √©lectronique
- description: "\n## üîê Modes d'authentification Chorus Pro\n\n**Tous les endpoints\
    \ Chorus Pro supportent 2 modes d'authentification :**\n\n### Mode 1 : Stock√©\
    \ (Stored Credentials)\n- Les credentials sont stock√©s chiffr√©s dans Django\n\
    - R√©cup√©r√©s automatiquement via le `client_uid` du JWT\n- **Django d√©cide** de\
    \ l'environnement (sandbox/production)\n- Pratique pour la production\n\n**Exemple**\
    \ :\n```json\n{\n  \"identifiant_structure\": \"12345678901234\",\n  \"type_identifiant_structure\"\
    : \"SIRET\"\n}\n```\n\n**JWT doit contenir** : claim `client_uid` pointant vers\
    \ une config Chorus Pro enregistr√©e\n\n---\n\n### Mode 2 : Zero-Trust\n- Les credentials\
    \ sont pass√©s dans le champ `credentials` de chaque requ√™te\n- Jamais stock√©s\
    \ en base de donn√©es\n- **Le client d√©cide** de l'environnement via `\"sandbox\"\
    : true/false`\n- S√©curit√© maximale, conformit√© RGPD\n\n**Exemple** :\n```json\n\
    {\n  \"credentials\": {\n    \"piste_client_id\": \"mon_client_id\",\n    \"piste_client_secret\"\
    : \"mon_secret\",\n    \"chorus_pro_login\": \"login@entreprise.fr\",\n    \"\
    chorus_pro_password\": \"password\",\n    \"sandbox\": true\n  },\n  \"identifiant_structure\"\
    : \"12345678901234\",\n  \"type_identifiant_structure\": \"SIRET\"\n}\n```\n\n\
    ---\n\n**Sch√©ma ChorusProCredentials** :\n- `piste_client_id` : Client ID PISTE\
    \ (portail OAuth2 du gouvernement)\n- `piste_client_secret` : Client Secret PISTE\n\
    - `chorus_pro_login` : Login Chorus Pro\n- `chorus_pro_password` : Mot de passe\
    \ Chorus Pro\n- `sandbox` : `true` = environnement de test, `false` = production\n\
    \n**Note** : Tous les endpoints ci-dessous supportent ces 2 modes. Le champ `credentials`\
    \ est optionnel dans chaque requ√™te.\n\nüìñ **Documentation compl√®te** : Voir `OPENAPI_AUTHENTICATION_MODES.md`\n\
    \        "
  name: Chorus Pro
- description: "\n## üîç V√©rification de coh√©rence PDF/XML Factur-X\n\n**V√©rifie que\
    \ les donn√©es visibles dans le PDF correspondent au XML Factur-X embarqu√©.**\n\
    \n### Fonctionnalit√©s\n\n- **Extraction PDF native** : Rapide, utilise pdfplumber\
    \ pour extraire le texte\n- **Extraction OCR** : Service DocTR pour les PDF images\
    \ (asynchrone)\n- **Comparaison** : Compare les donn√©es extraites du PDF avec\
    \ le XML Factur-X\n- **Rapport d'√©carts** : Liste des diff√©rences avec niveau\
    \ de gravit√© (CRITIQUE, AVERTISSEMENT, INFO)\n\n### Champs v√©rifi√©s\n\n**Identification**\
    \ : BT-1 (n¬∞ facture), BT-2 (date), BT-3 (type), BT-5 (devise)\n\n**Parties**\
    \ :\n- Vendeur : BT-27 (nom), BT-29 (SIRET), BT-30 (SIREN), BT-31 (TVA)\n- Acheteur\
    \ : BT-44 (nom), BT-46 (SIRET), BT-47 (SIREN), BT-48 (TVA)\n\n**Montants** : BT-109\
    \ (HT), BT-110 (TVA), BT-112 (TTC), BT-115 (√† payer)\n\n**Notes obligatoires**\
    \ : PMT (frais recouvrement), PMD (p√©nalit√©s retard), AAB (escompte)\n\n### Endpoints\n\
    \n- **POST /verifier** : V√©rification synchrone (PDF natif uniquement)\n- **POST\
    \ /verifier-async** : V√©rification asynchrone (avec OCR si n√©cessaire)\n- **GET\
    \ /verifier-async/{id}/statut** : Statut d'une v√©rification async\n- **POST /extraire**\
    \ : Extraction seule (sans comparaison XML)\n        "
  name: V√©rification PDF/XML
paths:
  /api/v1/traitement/generer-facture:
    post:
      description: |-
        G√©n√®re une facture √©lectronique au format Factur-X conforme aux normes europ√©ennes.

        ## Normes appliqu√©es

        - **Factur-X** (France) : Norme FNFE-MPE (Forum National de la Facture √âlectronique)
        - **ZUGFeRD** (Allemagne) : Format allemand compatible Factur-X
        - **EN 16931** : Norme s√©mantique europ√©enne pour la facturation √©lectronique
        - **ISO 19005-3** (PDF/A-3) : Archivage √©lectronique √† long terme
        - **Cross Industry Invoice (CII)** : Syntaxe XML UN/CEFACT

        ## üÜï Nouveau : Format simplifi√© avec auto-enrichissement (P0.1)

        Vous pouvez d√©sormais cr√©er une facture en fournissant uniquement :
        - Un num√©ro de facture
        - Un SIRET √©metteur + **IBAN** (obligatoire)
        - Un SIRET destinataire
        - Les lignes de facture (description, quantit√©, prix HT)

        **Exemple format simplifi√©** :
        ```json
        {
          "numero": "FACT-2025-001",
          "emetteur": {
            "siret": "92019522900017",
            "iban": "FR7630001007941234567890185"
          },
          "destinataire": {"siret": "35600000000048"},
          "lignes": [
            {"description": "Prestation", "quantite": 10, "prix_ht": 100.00, "tva": 20.0}
          ]
        }
        ```

        **‚ö†Ô∏è Champs obligatoires (format simplifi√©)** :
        - `numero` : Num√©ro de facture unique
        - `emetteur.siret` : SIRET de l'√©metteur (14 chiffres)
        - `emetteur.iban` : IBAN du compte bancaire (pas d'API publique pour le r√©cup√©rer)
        - `destinataire.siret` : SIRET du destinataire
        - `lignes[]` : Au moins une ligne de facture

        **Ce qui se passe automatiquement avec `auto_enrichir=True`** :
        - ‚úÖ Enrichissement des noms depuis API Chorus Pro
        - ‚úÖ Enrichissement des adresses depuis API Recherche Entreprises (gratuite, publique)
        - ‚úÖ Calcul automatique de la TVA intracommunautaire (FR + cl√© + SIREN)
        - ‚úÖ R√©cup√©ration de l'ID Chorus Pro pour la facturation √©lectronique
        - ‚úÖ Calcul des totaux HT/TVA/TTC
        - ‚úÖ G√©n√©ration des dates (aujourd'hui + √©ch√©ance 30j)
        - ‚úÖ Gestion multi-taux de TVA

        **Identifiants support√©s** :
        - SIRET (14 chiffres) : √âtablissement pr√©cis ‚≠ê Recommand√©
        - SIREN (9 chiffres) : Entreprise (s√©lection auto du si√®ge)
        - Types sp√©ciaux : UE_HORS_FRANCE, RIDET, TAHITI, etc.

        ## Contr√¥les effectu√©s lors de la g√©n√©ration

        ### 1. Validation des donn√©es (Pydantic)
        - Types de donn√©es (montants en Decimal, dates ISO 8601)
        - Formats (SIRET 14 chiffres, SIREN 9 chiffres, IBAN)
        - Champs obligatoires selon le profil
        - Coh√©rence des montants (HT + TVA = TTC)

        ### 2. G√©n√©ration XML conforme CII
        - S√©rialisation selon sch√©ma XSD Cross Industry Invoice
        - Namespaces UN/CEFACT corrects
        - Structure hi√©rarchique respect√©e
        - Encodage UTF-8 sans BOM

        ### 3. Validation Schematron
        - R√®gles m√©tier du profil s√©lectionn√© (MINIMUM, BASIC, EN16931, EXTENDED)
        - Cardinalit√© des √©l√©ments (obligatoire, optionnel, r√©p√©table)
        - R√®gles de calcul (totaux, TVA, remises)
        - Conformit√© europ√©enne EN 16931

        ### 4. Conversion PDF/A-3 (si format_sortie='pdf')
        - Conversion du PDF source en PDF/A-3 via Ghostscript
        - Embarquement du XML Factur-X dans le PDF
        - M√©tadonn√©es XMP conformes
        - Profil ICC sRGB pour les couleurs
        - Suppression des √©l√©ments interdits (JavaScript, formulaires)

        ## Fonctionnement

        1. **Soumission** : La facture est mise en file d'attente Celery pour traitement asynchrone
        2. **Retour imm√©diat** : Vous recevez un `id_tache` (HTTP 202 Accepted)
        3. **Suivi** : Utilisez l'endpoint `/taches/{id_tache}/statut` pour suivre l'avancement

        ## Formats de sortie

        - **xml** : G√©n√®re uniquement le XML Factur-X (recommand√© pour les tests)
        - **pdf** : G√©n√®re un PDF/A-3 avec XML embarqu√© (n√©cessite `source_pdf`)

        ## Profils Factur-X

        - **MINIMUM** : Donn√©es minimales (facture simplifi√©e)
        - **BASIC** : Informations de base (PME)
        - **EN16931** : Standard europ√©en (recommand√©, conforme directive 2014/55/UE)
        - **EXTENDED** : Toutes les donn√©es disponibles (grands comptes)

        ## Ce que vous obtenez

        Apr√®s traitement r√©ussi (statut `completed`) :
        - **XML seul** : Fichier XML encod√© base64 conforme Factur-X
        - **PDF/A-3** : PDF avec XML embarqu√©, pr√™t pour envoi/archivage
        - **M√©tadonn√©es** : Profil, version Factur-X, taille fichier
        - **Validation** : Confirmation de conformit√© Schematron

        ## Validation

        Les donn√©es sont valid√©es automatiquement selon le format d√©tect√©.
        En cas d'erreur, un statut 422 est retourn√© avec les d√©tails des champs invalides.
      operationId: generer_facture_api_v1_traitement_generer_facture_post
      requestBody:
        content:
          multipart/form-data:
            examples:
              exemple_complet:
                summary: Exemple de facture compl√®te
                value:
                  donnees_facture: |-
                    {
                      "numero_facture": "FACT-2025-001",
                      "date_facture": "2025-10-27",
                      "date_echeance_paiement": "2025-11-27",
                      "mode_depot": "DEPOT_PDF_API",
                      "destinataire": {
                        "nom": "Client Test SAS",
                        "adresse_electronique": {
                          "identifiant": "12345678901234",
                          "scheme_id": "0225"
                        },
                        "adresse_postale": {
                          "ligne_un": "456 Avenue des Champs",
                          "code_postal": "69001",
                          "nom_ville": "Lyon",
                          "pays_code_iso": "FR"
                        },
                        "code_service_executant": "SERVICE01"
                      },
                      "fournisseur": {
                        "nom": "Ma Soci\u00e9t\u00e9 SAS",
                        "id_fournisseur": 12345,
                        "siret": "12345678900001",
                        "numero_tva_intra": "FR12345678900",
                        "iban": "FR7630006000011234567890189",
                        "adresse_electronique": {
                          "identifiant": "12345678900001",
                          "scheme_id": "0225"
                        },
                        "adresse_postale": {
                          "ligne_un": "123 Rue de la R\u00e9publique",
                          "ligne_deux": "B\u00e2timent A",
                          "code_postal": "75001",
                          "nom_ville": "Paris",
                          "pays_code_iso": "FR"
                        }
                      },
                      "cadre_de_facturation": {
                        "code_cadre_facturation": "A1_FACTURE_FOURNISSEUR"
                      },
                      "references": {
                        "type_facture": "FACTURE",
                        "type_tva": "TVA_SUR_DEBIT",
                        "mode_paiement": "VIREMENT",
                        "devise_facture": "EUR",
                        "numero_bon_commande": "CMD-2025-042"
                      },
                      "lignes_de_poste": [
                        {
                          "numero": 1,
                          "denomination": "Prestation de conseil",
                          "quantite": "5.00",
                          "unite": "HEURE",
                          "montant_unitaire_ht": "200.00",
                          "montant_ligne_ht": "1000.00",
                          "taux_tva_manuel": "20.00",
                          "categorie_tva": "S",
                          "reference": "REF-CONSEIL-001"
                        },
                        {
                          "numero": 2,
                          "denomination": "Formation d\u00e9veloppeurs",
                          "quantite": "3.00",
                          "unite": "JOUR",
                          "montant_unitaire_ht": "500.00",
                          "montant_ligne_ht": "1500.00",
                          "categorie_tva": "S",
                          "taux_tva_manuel": "20.00",
                          "reference": "REF-FORM-002"
                        }
                      ],
                      "lignes_de_tva": [
                        {
                          "montant_base_ht": "2500.00",
                          "montant_tva": "500.00",
                          "taux_manuel": "20.00",
                          "categorie": "S"
                        }
                      ],
                      "montant_total": {
                        "montant_ht_total": "2500.00",
                        "montant_tva": "500.00",
                        "montant_ttc_total": "3000.00",
                        "montant_a_payer": "3000.00"
                      },
                      "commentaire": "Facture pour prestations du mois d'octobre 2025"
                    }
                  profil: EXTENDED
                  format_sortie: xml
            schema:
              $ref: "#/components/schemas/generer_facture_api_v1_traitement_generer_facture_post_request"
        required: true
      responses:
        "202":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReponseTache"
          description: Successful Response
        "400":
          description: Donn√©es de facture invalides ou fichier PDF manquant
        "422":
          description: Erreur de validation des donn√©es de la facture
      security:
      - HTTPBearer: []
      summary: G√©n√©rer une facture Factur-X
      tags:
      - Traitement Facture
      x-facture-facturx-schema:
        $ref: "#/components/schemas/FactureFacturX"
      x-content-type: multipart/form-data
      x-accepts:
      - application/json
  /api/v1/traitement/taches/{id_tache}/statut:
    get:
      description: |-
        R√©cup√®re l'√©tat d'avancement d'une t√¢che de g√©n√©ration de facture.

        ## √âtats possibles

        Le champ `statut` utilise l'enum `StatutCelery` avec les valeurs :
        - **PENDING, STARTED, SUCCESS, FAILURE, RETRY**

        Voir la documentation du sch√©ma `StatutCelery` pour les d√©tails.

        ## R√©sultat m√©tier

        Quand `statut="SUCCESS"`, le champ `resultat` contient :
        - `statut` : "SUCCES" ou "ERREUR" (r√©sultat m√©tier)
        - `chemin_fichier` : Chemin du fichier g√©n√©r√© (si succ√®s)
        - `errorCode`, `errorMessage`, `details` : Format AFNOR (si √©chec m√©tier)

        ## Usage

        Appelez cet endpoint en boucle (polling) toutes les 2-3 secondes jusqu'√† ce que
        `statut` soit `SUCCESS` ou `FAILURE`.
      operationId: obtenir_statut_tache_api_v1_traitement_taches__id_tache__statut_get
      parameters:
      - explode: false
        in: path
        name: id_tache
        required: true
        schema:
          title: Id Tache
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatutTache"
          description: √âtat actuel de la t√¢che
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Obtenir le statut d'une t√¢che de g√©n√©ration
      tags:
      - Traitement Facture
      x-accepts:
      - application/json
  /api/v1/traitement/valider-xml:
    post:
      description: |-
        Valide un fichier XML Factur-X contre les r√®gles m√©tier Schematron selon la norme EN 16931.

        ## Norme appliqu√©e

        **Schematron ISO/IEC 19757-3** : Langage de validation de r√®gles m√©tier pour XML
        - Validation s√©mantique (au-del√† de la syntaxe XSD)
        - R√®gles m√©tier europ√©ennes EN 16931
        - R√®gles fran√ßaises sp√©cifiques Factur-X
        - Calculs arithm√©tiques et coh√©rence des donn√©es

        ## Profils et r√®gles valid√©es

        ### MINIMUM (45 r√®gles)
        - Identifiant de facture unique
        - Dates (√©mission, √©ch√©ance)
        - Identifiants parties (SIRET/SIREN)
        - Montant total TTC

        ### BASIC (102 r√®gles)
        - Toutes les r√®gles MINIMUM
        - Lignes de facture d√©taill√©es
        - Calculs de TVA basiques
        - Modes de paiement
        - R√©f√©rences (commande, contrat)

        ### EN16931 (178 r√®gles)
        - Toutes les r√®gles BASIC
        - **R√®gles europ√©ennes (BR-xx)** : 81 r√®gles business
        - **R√®gles fran√ßaises (FR-xx)** : 12 r√®gles sp√©cifiques France
        - **Calculs avanc√©s (CR-xx)** : 32 r√®gles de calcul
        - **Codes normalis√©s (CL-xx)** : 52 listes de codes

        ### EXTENDED (210+ r√®gles)
        - Toutes les r√®gles EN16931
        - Informations logistiques
        - Donn√©es comptables avanc√©es
        - R√©f√©rences externes multiples

        ## Contr√¥les effectu√©s

        ### 1. Validation syntaxique
        - Parsing XML correct (UTF-8, bien form√©)
        - Namespaces UN/CEFACT pr√©sents
        - Structure hi√©rarchique respect√©e

        ### 2. R√®gles business (BR-xx)
        Exemples :
        - `BR-1` : Le total de la facture doit √™tre √©gal √† la somme des totaux de lignes + montants au niveau document
        - `BR-CO-10` : La somme des montants de base de TVA doit √™tre √©gale au total net de la facture
        - `BR-16` : Le code de devise de la facture doit figurer dans la liste ISO 4217

        ### 3. R√®gles fran√ßaises (FR-xx)
        Exemples :
        - `FR-1` : Le SIRET fournisseur doit avoir 14 chiffres
        - `FR-2` : Le SIRET client doit avoir 14 chiffres (si pr√©sent)
        - `FR-5` : Le num√©ro de TVA intracommunautaire doit √™tre au format FRxx999999999

        ### 4. R√®gles de calcul (CR-xx)
        - Montants HT + TVA = TTC
        - Somme des lignes = Total document
        - Remises et majorations correctement appliqu√©es
        - Arrondis conformes (2 d√©cimales pour les montants)

        ### 5. Codes normalis√©s (CL-xx)
        - Codes pays ISO 3166-1 alpha-2
        - Codes devises ISO 4217
        - Unit√©s de mesure UN/ECE Rec 20
        - Codes TVA (types, cat√©gories, exon√©rations)
        - SchemeID pour identifiants (0002=SIREN, 0009=SIRET, etc.)

        ## Processus de validation

        1. **Chargement XSLT** : Fichier Schematron converti en XSLT (Saxon-HE)
        2. **Transformation** : Application des r√®gles sur le XML
        3. **Analyse r√©sultats** : Extraction des erreurs (`failed-assert`) et avertissements (`successful-report`)
        4. **Rapport** : Liste structur√©e des non-conformit√©s

        ## R√©ponses

        **200 OK** : XML conforme
        ```json
        {
          "message": "Le XML est conforme au profil EN16931"
        }
        ```

        **400 Bad Request** : XML non conforme
        ```json
        {
          "detail": [
            "[BR-1] Le total de la facture (120.00) ne correspond pas √† la somme calcul√©e (100.00 + 20.00)",
            "[FR-1] Le SIRET fournisseur doit contenir exactement 14 chiffres"
          ]
        }
        ```

        ## Cas d'usage

        - **Pr√©-validation** : V√©rifier un XML avant int√©gration dans un PDF/A
        - **Debugging** : Identifier pr√©cis√©ment les erreurs de g√©n√©ration
        - **Tests** : Valider des XMLs de test ou d'exemple
        - **Conformit√©** : S'assurer du respect des r√®gles europ√©ennes et fran√ßaises
        - **D√©veloppement** : Tester rapidement sans g√©n√©rer de PDF

        ## Temps de traitement

        - Profil MINIMUM : ~0.5 seconde
        - Profil EN16931 : ~1-2 secondes
        - Profil EXTENDED : ~2-3 secondes
      operationId: valider_xml_api_v1_traitement_valider_xml_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/Body_valider_xml_api_v1_traitement_valider_xml_post"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReponseValidationSucces"
          description: Successful Response
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReponseValidationErreur"
          description: Le XML ne respecte pas les r√®gles du profil Factur-X
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Valider un XML Factur-X existant
      tags:
      - Traitement Facture
      x-content-type: multipart/form-data
      x-accepts:
      - application/json
  /api/v1/traitement/valider-pdf-facturx:
    post:
      description: |-
        Valide un PDF Factur-X complet selon les normes europ√©ennes et fran√ßaises.

        ## Normes de validation appliqu√©es

        - **EN 16931** : Norme s√©mantique europ√©enne (directive 2014/55/UE)
        - **ISO 19005-3** (PDF/A-3) : Archivage √©lectronique √† long terme
        - **Factur-X / ZUGFeRD** : Sp√©cification franco-allemande
        - **Schematron** : Validation des r√®gles m√©tier XML
        - **eIDAS** : R√®glement europ√©en sur l'identification √©lectronique (signatures)

        ## Contr√¥les effectu√©s

        ### 1. Extraction et validation du XML Factur-X
        **Contr√¥les r√©alis√©s :**
        - Pr√©sence d'un fichier XML embarqu√© (`factur-x.xml` ou `zugferd-invoice.xml`)
        - D√©tection automatique du profil (MINIMUM, BASIC, EN16931, EXTENDED)
        - Parsing XML avec validation UTF-8
        - Extraction du GuidelineSpecifiedDocumentContextParameter/ID

        **Validation Schematron :**
        - R√®gles m√©tier du profil d√©tect√© (MINIMUM : 45 r√®gles, EN16931 : 178 r√®gles)
        - Cardinalit√© des √©l√©ments obligatoires
        - Coh√©rence des calculs (montants HT, TVA, TTC, remises)
        - Formats des identifiants (SIRET, TVA intracommunautaire, IBAN)
        - Codes normalis√©s (codes pays ISO, unit√©s UN/ECE, codes TVA)

        **Ce qui est v√©rifi√© :**
        - ‚úÖ Structure XML conforme XSD Cross Industry Invoice
        - ‚úÖ Namespace UN/CEFACT correct
        - ‚úÖ R√®gles de gestion europ√©ennes (BR-xx)
        - ‚úÖ R√®gles fran√ßaises sp√©cifiques (FR-xx)

        ### 2. Conformit√© PDF/A-3
        **Validation de base (m√©tadonn√©es) :**
        - Pr√©sence du champ `/Type` √† `Catalog`
        - M√©tadonn√©e `pdfaid:part` = 3 (PDF/A-3)
        - M√©tadonn√©e `pdfaid:conformance` = B ou U
        - Version PDF >= 1.4

        **Validation stricte VeraPDF (si use_verapdf=True) :**
        - 146+ r√®gles ISO 19005-3 (PDF/A-3B)
        - Absence de contenu interdit (JavaScript, multimedia, formulaires dynamiques)
        - Polices embarqu√©es et sous-ensembles corrects
        - Espaces colorim√©triques conformes (sRGB, DeviceGray)
        - Structure de fichier valide (cross-reference table)
        - M√©tadonn√©es XMP conformes ISO 16684-1

        **Ce qui est v√©rifi√© :**
        - ‚úÖ Fichier archivable √† long terme (20+ ans)
        - ‚úÖ Lisibilit√© garantie (polices embarqu√©es)
        - ‚úÖ Conformit√© l√©gale (France, Allemagne, UE)

        ### 3. M√©tadonn√©es XMP (eXtensible Metadata Platform)
        **Contr√¥les r√©alis√©s :**
        - Pr√©sence du bloc `<?xpacket>` avec m√©tadonn√©es XMP
        - Namespace `fx:` pour Factur-X : `urn:factur-x:pdfa:CrossIndustryDocument:invoice:1p0#`
        - Champs Factur-X obligatoires :
          - `fx:ConformanceLevel` : Profil (MINIMUM, BASIC, EN16931, EXTENDED)
          - `fx:DocumentFileName` : Nom du XML embarqu√©
          - `fx:DocumentType` : "INVOICE"
          - `fx:Version` : Version Factur-X (1.0.07)

        **Ce qui est v√©rifi√© :**
        - ‚úÖ M√©tadonn√©es conformes ISO 16684-1
        - ‚úÖ Profil Factur-X d√©clar√© correct
        - ‚úÖ Version Factur-X support√©e

        ### 4. Signatures √©lectroniques
        **D√©tection et analyse :**
        - Pr√©sence de dictionnaires `/Sig` dans le PDF
        - Type de signature : PAdES (PDF Advanced Electronic Signature)
        - Extraction des informations :
          - Nom du signataire (`/Name`)
          - Date de signature (`/M`)
          - Raison de la signature (`/Reason`)
          - Lieu de signature (`/Location`)
          - Type de signature (approval, certification)

        **Ce qui est v√©rifi√© :**
        - ‚úÖ Pr√©sence de signatures ou cachets
        - ‚úÖ Nombre de signatures (mono ou multi-signature)
        - ‚ÑπÔ∏è Pas de v√©rification cryptographique (n√©cessite certificats)

        ## Param√®tres

        - **fichier_pdf** (requis) : Le fichier PDF Factur-X √† valider
        - **profil** (optionnel) : Profil attendu. Si absent, d√©tection automatique depuis le XML
        - **use_verapdf** (optionnel, d√©faut=false) : Active la validation stricte PDF/A avec VeraPDF
          - `false` : Validation rapide par m√©tadonn√©es (2-3 secondes)
          - `true` : Validation compl√®te ISO 19005-3 (15-30 secondes, **recommand√© en production**)

        ## R√©ponse d√©taill√©e

        ```json
        {
          "est_conforme": true,
          "xml": {
            "present": true,
            "conforme": true,
            "profil": "EN16931",
            "erreurs": []
          },
          "pdfa": {
            "conforme": true,
            "version": "PDF/A-3B",
            "methode": "verapdf",
            "erreurs": []
          },
          "xmp": {
            "present": true,
            "conforme": true,
            "metadonnees": {...}
          },
          "signatures": {
            "present": true,
            "nombre": 1,
            "details": [...]
          }
        }
        ```

        ## Cas d'usage

        - **Avant envoi** : Valider la facture g√©n√©r√©e avant transmission √† un client
        - **√Ä r√©ception** : V√©rifier la conformit√© d'une facture re√ßue d'un fournisseur
        - **Audit** : Contr√¥ler la qualit√© de lots de factures
        - **Conformit√© l√©gale** : S'assurer du respect des obligations B2B/B2G en France
        - **Debugging** : Identifier les probl√®mes dans le processus de g√©n√©ration
        - **Archivage** : Garantir la validit√© √† long terme (PDF/A-3)

        ## Temps de traitement

        - Validation basique : 2-3 secondes
        - Validation VeraPDF : 15-30 secondes (d√©pend de la taille du PDF)
      operationId: valider_pdf_facturx_api_v1_traitement_valider_pdf_facturx_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/Body_valider_pdf_facturx_api_v1_traitement_valider_pdf_facturx_post"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResultatValidationPDFAPI"
          description: Validation effectu√©e avec succ√®s (v√©rifier le champ est_conforme
            pour le r√©sultat)
        "400":
          description: Fichier PDF invalide ou impossible √† lire
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Valider un PDF Factur-X complet
      tags:
      - Traitement Facture
      x-content-type: multipart/form-data
      x-accepts:
      - application/json
  /api/v1/traitement/valider-facturx-async:
    post:
      description: |-
        Valide un PDF Factur-X de mani√®re asynchrone avec syst√®me de polling.

        ## Fonctionnement

        1. **Soumission** : Le PDF est mis en file d'attente pour validation asynchrone
        2. **Retour imm√©diat** : Vous recevez un `id_tache` (HTTP 202)
        3. **Suivi** : Utilisez l'endpoint `/taches/{id_tache}/statut` pour suivre l'avancement

        ## Avantages du mode asynchrone

        - **Pas de timeout** : Id√©al pour les gros PDFs ou la validation VeraPDF (qui peut prendre plusieurs secondes)
        - **Scalabilit√©** : Les validations sont trait√©es par des workers Celery d√©di√©s
        - **Suivi d'√©tat** : Permet de suivre la progression de la validation
        - **Non-bloquant** : Votre client ne reste pas en attente pendant la validation

        ## Quand utiliser ce mode ?

        - **Validation VeraPDF activ√©e** (`use_verapdf=True`) : La validation stricte peut prendre 2-10 secondes
        - **Gros fichiers PDF** : PDFs > 1 MB
        - **Traitement par lots** : Validation de multiples factures en parall√®le
        - **Int√©gration asynchrone** : Votre syst√®me supporte le polling

        ## Contr√¥les effectu√©s

        ### 1. Extraction et validation du XML Factur-X
        - V√©rifie la pr√©sence d'un fichier XML embarqu√© conforme Factur-X
        - D√©tecte automatiquement le profil utilis√© (MINIMUM, BASIC, EN16931, EXTENDED)
        - Valide le XML contre les r√®gles Schematron du profil d√©tect√©

        ### 2. Conformit√© PDF/A
        - **Sans VeraPDF** : Validation basique par m√©tadonn√©es (rapide, ~100ms)
        - **Avec VeraPDF** : Validation stricte selon ISO 19005 (146+ r√®gles, 2-10s)
          - D√©tecte la version PDF/A (PDF/A-1, PDF/A-3, etc.)
          - Rapports d√©taill√©s des non-conformit√©s

        ### 3. M√©tadonn√©es XMP
        - V√©rifie la pr√©sence de m√©tadonn√©es XMP dans le PDF
        - Valide la conformit√© des m√©tadonn√©es Factur-X (profil, version)
        - Extrait toutes les m√©tadonn√©es XMP disponibles

        ### 4. Signatures √©lectroniques
        - D√©tecte la pr√©sence de signatures ou cachets √©lectroniques
        - Extrait les informations sur chaque signature (signataire, date, raison)
        - Compte le nombre de signatures pr√©sentes

        ## Param√®tres

        - **fichier_pdf** : Le fichier PDF Factur-X √† valider
        - **profil** : Le profil Factur-X attendu (optionnel). Si non sp√©cifi√©, le profil
          sera automatiquement d√©tect√© depuis le fichier XML embarqu√©.
        - **use_verapdf** : Active la validation stricte PDF/A avec VeraPDF.
          ‚ö†Ô∏è **Attention** : VeraPDF peut prendre 2-10 secondes selon la taille du PDF.
          Recommand√© uniquement en mode asynchrone pour √©viter les timeouts.

        ## R√©cup√©ration du r√©sultat

        Apr√®s soumission, utilisez l'endpoint `GET /taches/{id_tache}/statut` pour r√©cup√©rer le r√©sultat.

        **Exemple de polling** :
        ```python
        import requests
        import time

        # 1. Soumettre la t√¢che
        response = requests.post("/valider-facturx-async", files={"fichier_pdf": pdf_file})
        task_id = response.json()["id_tache"]

        # 2. Polling toutes les 2 secondes
        while True:
            status_response = requests.get(f"/taches/{task_id}/statut")
            status = status_response.json()

            if status["statut"] == "SUCCESS":
                resultat = status["resultat"]["resultat_validation"]
                print(f"Conforme: {resultat['est_conforme']}")
                break
            elif status["statut"] == "FAILURE":
                print(f"Erreur: {status['resultat']['errorMessage']}")
                break

            time.sleep(2)  # Attendre 2 secondes avant le prochain check
        ```

        ## Cas d'usage

        - Valider des factures avant envoi avec VeraPDF (validation stricte)
        - Traiter des lots de factures en parall√®le
        - Int√©grer la validation dans un pipeline asynchrone
        - Valider des PDFs volumineux sans risque de timeout
      operationId: valider_pdf_facturx_async_api_v1_traitement_valider_facturx_async_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/Body_valider_pdf_facturx_async_api_v1_traitement_valider_facturx_async_post"
        required: true
      responses:
        "202":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReponseTache"
          description: Successful Response
        "400":
          description: Fichier PDF invalide ou impossible √† lire
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Valider un PDF Factur-X (asynchrone avec polling)
      tags:
      - Traitement Facture
      x-content-type: multipart/form-data
      x-accepts:
      - application/json
  /api/v1/traitement/signer-pdf:
    post:
      description: |-
        Signe un PDF upload√© avec le certificat √©lectronique configur√© pour le client (via client_uid du JWT).

            **Standards support√©s** : PAdES-B-B, PAdES-B-T (horodatage), PAdES-B-LT (archivage long terme).

            **Niveaux eIDAS** : SES (auto-sign√©), AdES (CA commerciale), QES (PSCO - hors scope).

            **S√©curit√©** : Double authentification X-Internal-Secret + JWT Bearer pour r√©cup√©rer le certificat.

            **‚ö†Ô∏è Disclaimer l√©gal** : Les signatures g√©n√©r√©es sont des cachets √©lectroniques au sens
            du r√®glement eIDAS. Le niveau de validit√© juridique d√©pend du certificat utilis√© (SES/AdES/QES).
            FactPulse ne fournit pas de certificats qualifi√©s QES - vous devez obtenir un certificat aupr√®s
            d'un PSCO (Prestataire de Services de Confiance qualifi√©) pour une validit√© juridique maximale.
      operationId: signer_pdf_api_v1_traitement_signer_pdf_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/Body_signer_pdf_api_v1_traitement_signer_pdf_post"
        required: true
      responses:
        "200":
          content:
            application/json:
              example:
                status: success
                pdf_signe_base64: JVBERi0xLjQKJeLjz9MKNSAwIG9iago8PC...
                nom_fichier: facture_signed.pdf
                taille_octets: 156789
                is_signed: true
                signer_cn: ACME Corporation - Cachet Serveur
                date_signature: 2025-01-15T14:30:00+00:00
                expiration_certificat: 2026-12-31T23:59:59+00:00
              schema: {}
          description: PDF sign√© avec succ√®s
        "400":
          content:
            application/json:
              example:
                error: invalid_certificate
                message: Certificat invalide ou expir√©
                help: Veuillez mettre √† jour votre certificat dans votre espace FactPulse
          description: Certificat invalide ou expir√©
        "404":
          content:
            application/json:
              example:
                error: no_certificate
                message: Aucun certificat de signature configur√© pour ce client
                help: Veuillez ajouter un certificat dans votre espace FactPulse (Param√®tres
                  > Certificat de signature)
                client_uid: 550e8400-e29b-41d4-a716-446655440000
          description: Aucun certificat configur√© pour ce client
        "401":
          description: Non authentifi√© - Token JWT manquant ou invalide
        "503":
          description: Service Django inaccessible
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Signer un PDF avec le certificat du client (PAdES-B-LT)
      tags:
      - Traitement Facture
      x-content-type: multipart/form-data
      x-accepts:
      - application/json
  /api/v1/traitement/signer-pdf-async:
    post:
      description: |-
        Signe un PDF upload√© de mani√®re asynchrone via une t√¢che Celery.

            **Diff√©rence avec /signer-pdf** :
            - `/signer-pdf` : Signature synchrone (blocage jusqu'√† la fin)
            - `/signer-pdf-async` : Signature asynchrone (retourne imm√©diatement un task_id)

            **Avantages de l'async** :
            - Pas de timeout pour les gros fichiers
            - Pas de blocage du worker FastAPI
            - Possibilit√© de suivre la progression via le task_id
            - Id√©al pour les traitements par lot

            **Standards support√©s** : PAdES-B-B, PAdES-B-T (horodatage), PAdES-B-LT (archivage long terme).

            **‚ö†Ô∏è Disclaimer l√©gal** : Identique √† /signer-pdf (voir documentation de cet endpoint).
      operationId: signer_pdf_async_api_v1_traitement_signer_pdf_async_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/Body_signer_pdf_async_api_v1_traitement_signer_pdf_async_post"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "202":
          content:
            application/json:
              example:
                task_id: 550e8400-e29b-41d4-a716-446655440000
                status: PENDING
                message: La signature est en cours de traitement
          description: T√¢che de signature cr√©√©e avec succ√®s
        "400":
          description: Param√®tres invalides
        "401":
          description: Non authentifi√© - Token JWT manquant ou invalide
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Signer un PDF de mani√®re asynchrone (Celery)
      tags:
      - Traitement Facture
      x-content-type: multipart/form-data
      x-accepts:
      - application/json
  /api/v1/traitement/valider-signature-pdf:
    post:
      description: |-
        Valide les signatures √©lectroniques pr√©sentes dans un PDF upload√©.

            **V√©rifications effectu√©es** :
            - Pr√©sence de signatures
            - Int√©grit√© du document (non modifi√© depuis signature)
            - Validit√© des certificats
            - Cha√Æne de confiance (si disponible)
            - Pr√©sence d'horodatage (PAdES-B-T)
            - Donn√©es de validation (PAdES-B-LT)

            **Standards support√©s** : PAdES-B-B, PAdES-B-T, PAdES-B-LT, ISO 32000-2.

            **‚ö†Ô∏è Note** : Cette validation est technique (int√©grit√© cryptographique). La validit√© juridique
            d√©pend du niveau eIDAS du certificat (SES/AdES/QES) et du contexte d'utilisation.
      operationId: valider_signature_pdf_endpoint_api_v1_traitement_valider_signature_pdf_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/Body_valider_signature_pdf_endpoint_api_v1_traitement_valider_signature_pdf_post"
        required: true
      responses:
        "200":
          content:
            application/json:
              example:
                est_signe: true
                nombre_signatures: 1
                signatures:
                - nom_champ: FactPulseSignature
                  signataire: ACME Corporation - Cachet Serveur
                  date_signature: 2025-01-15T14:30:00+00:00
                  raison: Conformit√© Factur-X
                  localisation: "Paris, France"
                  est_valide: true
                  niveau_pades: PAdES-B-LT
                  horodatage: true
                  validation_data: true
                erreurs: []
              schema: {}
          description: Validation r√©ussie
        "400":
          description: Fichier invalide ou non lisible
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Valider les signatures √©lectroniques d'un PDF
      tags:
      - Traitement Facture
      x-content-type: multipart/form-data
      x-accepts:
      - application/json
  /api/v1/traitement/generer-certificat-test:
    post:
      description: |-
        G√©n√®re un certificat X.509 auto-sign√© pour les tests de signature √©lectronique PDF.

            **‚ö†Ô∏è ATTENTION : Certificat de TEST uniquement !**

            Ce certificat est :
            - ‚úÖ Adapt√© pour tests et d√©veloppement
            - ‚úÖ Compatible signature PDF (PAdES)
            - ‚úÖ Conforme eIDAS niveau **SES** (Simple Electronic Signature)
            - ‚ùå **JAMAIS utilisable en production**
            - ‚ùå **Non reconnu** par les navigateurs et lecteurs PDF
            - ‚ùå **Aucune valeur juridique**

            ## Niveaux eIDAS

            - **SES** (Simple) : Certificat auto-sign√© ‚Üê G√©n√©r√© par cet endpoint
            - **AdES** (Advanced) : Certificat CA commerciale (Let's Encrypt, etc.)
            - **QES** (Qualified) : Certificat qualifi√© PSCO (CertEurope, Universign, etc.)

            ## Utilisation

            Une fois g√©n√©r√©, le certificat peut √™tre :

            1. **Enregistr√© dans Django** (recommand√©) :
               - Django Admin > Certificats de signature
               - Upload `certificat_pem` et `cle_privee_pem`

            2. **Utilis√© directement** :
               - Signer un PDF avec `/signer-pdf`
               - Le certificat sera automatiquement utilis√©

            ## Exemple d'appel

            ```bash
            curl -X POST "https://www.factpulse.fr/api/facturation/generer-certificat-test" \
              -H "Authorization: Bearer eyJ0eXAi..." \
              -H "Content-Type: application/json" \
              -d '{
                "cn": "Test Client XYZ",
                "organisation": "Client XYZ SARL",
                "email": "contact@xyz.fr",
                "duree_jours": 365
              }'
            ```

            ## Cas d'usage

            - Tests de signature PDF en d√©veloppement
            - POC de signature √©lectronique
            - Formation et d√©mos
            - Tests d'int√©gration automatis√©s

            ## Conformit√© technique

            Certificat g√©n√©r√© avec :
            - Cl√© RSA 2048 ou 4096 bits
            - Algorithme SHA-256
            - Extensions Key Usage : `digitalSignature`, `contentCommitment` (non-repudiation)
            - Extensions Extended Key Usage : `codeSigning`, `emailProtection`
            - Validit√© : 1 jour √† 10 ans (configurable)
            - Format : PEM (certificat et cl√©)
            - Optionnel : PKCS#12 (.p12)
      operationId: generer_certificat_test_api_v1_traitement_generer_certificat_test_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateCertificateRequest"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenerateCertificateResponse"
          description: Certificat g√©n√©r√© avec succ√®s
        "400":
          content:
            application/json:
              example:
                detail: La taille de cl√© doit √™tre 2048 ou 4096
          description: Requ√™te invalide (param√®tres incorrects)
        "500":
          content:
            application/json:
              example:
                detail: "Erreur lors de la g√©n√©ration du certificat: ..."
          description: Erreur serveur lors de la g√©n√©ration
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: G√©n√©rer un certificat X.509 auto-sign√© de test
      tags:
      - Traitement Facture
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/traitement/factures/soumettre-complete:
    post:
      description: |-
        Endpoint unifi√© pour soumettre une facture compl√®te vers diff√©rentes destinations.

            **Workflow automatis√© :**
            1. **Auto-enrichissement** (optionnel) : r√©cup√®re les donn√©es via APIs publiques et Chorus Pro/AFNOR
            2. **G√©n√©ration PDF Factur-X** : cr√©e un PDF/A-3 avec XML embarqu√©
            3. **Signature √©lectronique** (optionnelle) : signe le PDF avec un certificat
            4. **Soumission** : envoie vers la destination choisie (Chorus Pro ou AFNOR PDP)

            **Destinations support√©es :**
            - **Chorus Pro** : plateforme B2G fran√ßaise (factures vers secteur public)
            - **AFNOR PDP** : Plateformes de D√©mat√©rialisation Partenaires

            **Credentials de destination - 2 modes disponibles :**

            **Mode 1 - R√©cup√©ration via JWT (recommand√©) :**
            - Les credentials sont r√©cup√©r√©s automatiquement via le `client_uid` du JWT
            - Ne pas fournir le champ `credentials` dans `destination`
            - Architecture 0-trust : aucun secret dans le payload
            - Exemple : `"destination": {"type": "chorus_pro"}`

            **Mode 2 - Credentials dans le payload :**
            - Fournir les credentials directement dans le payload
            - Utile pour tests ou int√©grations tierces
            - Exemple : `"destination": {"type": "chorus_pro", "credentials": {...}}`


            **Signature √©lectronique (optionnelle) - 2 modes disponibles :**

            **Mode 1 - Certificat stock√© (recommand√©) :**
            - Le certificat est r√©cup√©r√© automatiquement via le `client_uid` du JWT
            - Aucune cl√© √† fournir dans le payload
            - Signature PAdES-B-LT avec horodatage (conforme eIDAS)
            - Exemple : `"signature": {"raison": "Conformit√© Factur-X"}`

            **Mode 2 - Cl√©s dans le payload (pour tests) :**
            - Fournir `key_pem` et `cert_pem` directement
            - Format PEM accept√© : brut ou base64
            - Utile pour tests ou cas sp√©ciaux sans certificat stock√©
            - Exemple : `"signature": {"key_pem": "-----BEGIN...", "cert_pem": "-----BEGIN..."}`

            Si `key_pem` et `cert_pem` sont fournis ‚Üí Mode 2
            Sinon ‚Üí Mode 1 (certificat r√©cup√©r√© via `client_uid`)
      operationId: soumettre_facture_complete_api_v1_traitement_factures_soumettre_complete_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SoumettreFactureCompleteRequest"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SoumettreFactureCompleteResponse"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Soumettre une facture compl√®te (g√©n√©ration + signature + soumission)
      tags:
      - Traitement Facture
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/traitement/factures/soumettre-complete-async:
    post:
      description: |-
        Version asynchrone de l'endpoint `/factures/soumettre-complete` utilisant Celery pour le traitement en arri√®re-plan.

            **Workflow automatis√© (identique √† la version synchrone) :**
            1. **Auto-enrichissement** (optionnel) : r√©cup√®re les donn√©es via APIs publiques et Chorus Pro/AFNOR
            2. **G√©n√©ration PDF Factur-X** : cr√©e un PDF/A-3 avec XML embarqu√©
            3. **Signature √©lectronique** (optionnelle) : signe le PDF avec un certificat
            4. **Soumission** : envoie vers la destination choisie (Chorus Pro ou AFNOR PDP)

            **Destinations support√©es :**
            - **Chorus Pro** : plateforme B2G fran√ßaise (factures vers secteur public)
            - **AFNOR PDP** : Plateformes de D√©mat√©rialisation Partenaires

            **Diff√©rences avec la version synchrone :**
            - ‚úÖ **Non-bloquant** : Retourne imm√©diatement un `id_tache` (HTTP 202 Accepted)
            - ‚úÖ **Traitement en arri√®re-plan** : La facture est trait√©e par un worker Celery
            - ‚úÖ **Suivi d'avancement** : Utilisez `/taches/{id_tache}/statut` pour suivre le statut
            - ‚úÖ **Id√©al pour gros volumes** : Permet de traiter de nombreuses factures en parall√®le

            **Comment utiliser :**
            1. **Soumission** : Appelez cet endpoint avec vos donn√©es de facture
            2. **Retour imm√©diat** : Vous recevez un `id_tache` (ex: "abc123-def456")
            3. **Suivi** : Appelez `/taches/{id_tache}/statut` pour v√©rifier l'avancement
            4. **R√©sultat** : Quand `statut = "SUCCESS"`, le champ `resultat` contient la r√©ponse compl√®te

            **Credentials et signature** : M√™mes modes que la version synchrone (JWT ou payload).
      operationId: soumettre_facture_complete_async_api_v1_traitement_factures_soumettre_complete_async_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SoumettreFactureCompleteRequest"
        required: true
      responses:
        "202":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReponseTache"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Soumettre une facture compl√®te (asynchrone avec Celery)
      tags:
      - Traitement Facture
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/afnor/credentials:
    get:
      description: R√©cup√®re les credentials AFNOR/PDP stock√©s pour le client_uid du
        JWT. Cet endpoint est utilis√© par le SDK en mode 'stored' pour r√©cup√©rer les
        credentials avant de faire l'OAuth AFNOR lui-m√™me.
      operationId: get_afnor_credentials_api_v1_afnor_credentials_get
      responses:
        "200":
          content:
            application/json:
              example:
                flow_service_url: https://api.pdp-partner.fr/flow/v1
                token_url: https://auth.pdp-partner.fr/oauth/token
                client_id: factpulse_client
                client_secret: '***'
              schema: {}
          description: Credentials AFNOR r√©cup√©r√©s avec succ√®s
        "400":
          content:
            application/json:
              example:
                detail:
                  error: NO_CLIENT_UID
                  message: Aucun client_uid dans le JWT. Utilisez le mode zero-trust.
          description: Aucun client_uid dans le JWT
        "401":
          description: Non authentifi√© - Token JWT manquant ou invalide
        "404":
          description: Client non trouv√© ou pas de credentials AFNOR configur√©s
      security:
      - HTTPBearer: []
      summary: R√©cup√©rer les credentials AFNOR stock√©s
      tags:
      - AFNOR PDP/PA
      x-accepts:
      - application/json
  /api/v1/afnor/oauth/token:
    post:
      description: Endpoint proxy OAuth2 pour obtenir un token d'acc√®s AFNOR. Fait
        proxy vers le mock AFNOR (sandbox) ou la vraie PDP selon MOCK_AFNOR_BASE_URL.
        Cet endpoint est public (pas d'auth Django requise) car il est appel√© par
        le SDK AFNOR.
      operationId: oauth_token_proxy_api_v1_afnor_oauth_token_post
      responses:
        "200":
          content:
            application/json:
              example:
                access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                token_type: Bearer
                expires_in: 3600
              schema: {}
          description: Token OAuth2 acquis avec succ√®s
        "401":
          description: Credentials invalides
      summary: Endpoint OAuth2 pour authentification AFNOR
      tags:
      - AFNOR PDP/PA
      x-accepts:
      - application/json
  /api/v1/afnor/flux-entrants/{flow_id}:
    get:
      description: "T√©l√©charge un flux entrant depuis la PDP AFNOR et extrait les\
        \ m√©tadonn√©es de la facture vers un format JSON unifi√©. Supporte les formats\
        \ Factur-X, CII et UBL."
      operationId: get_flux_entrant_api_v1_afnor_flux_entrants__flow_id__get
      parameters:
      - explode: false
        in: path
        name: flow_id
        required: true
        schema:
          title: Flow Id
          type: string
        style: simple
      - explode: true
        in: query
        name: include_document
        required: false
        schema:
          default: false
          title: Include Document
          type: boolean
        style: form
      responses:
        "200":
          content:
            application/json:
              example:
                flow_id: 550e8400-e29b-41d4-a716-446655440000
                format_source: Factur-X
                ref_fournisseur: FAC-2025-001
                type_document: "380"
                fournisseur:
                  nom: Fournisseur SAS
                  siret: "12345678901234"
                  numero_tva_intra: FR12345678901
                site_facturation_nom: Ma Soci√©t√©
                site_facturation_siret: "98765432109876"
                date_de_piece: 2025-01-15
                date_reglement: 2025-02-15
                devise: EUR
                montant_ht: "1000.00"
                montant_tva: "200.00"
                montant_ttc: "1200.00"
              schema:
                $ref: "#/components/schemas/FactureEntrante"
          description: Facture extraite avec succ√®s
        "400":
          description: Format de facture non support√© ou invalide
        "401":
          description: Non authentifi√©
        "404":
          description: Flux non trouv√©
        "503":
          description: Service PDP indisponible
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: R√©cup√©rer et extraire une facture entrante
      tags:
      - AFNOR PDP/PA
      x-accepts:
      - application/json
  /api/v1/afnor/flow/v1/healthcheck:
    get:
      description: V√©rifier la disponibilit√© du Flow Service
      operationId: flow_healthcheck_proxy_api_v1_afnor_flow_v1_healthcheck_get
      responses:
        "200":
          content:
            application/json:
              example:
                status: ok
                service: Flow Service
              schema: {}
          description: Service op√©rationnel
      summary: Healthcheck Flow Service
      tags:
      - AFNOR PDP/PA - Flow Service
      x-accepts:
      - application/json
  /api/v1/afnor/flow/v1/flows:
    post:
      description: Soumet une facture √©lectronique √† une Plateforme de D√©mat√©rialisation
        Partenaire (PDP) conform√©ment √† la norme AFNOR XP Z12-013
      operationId: submit_flow_proxy_api_v1_afnor_flow_v1_flows_post
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "201":
          content:
            application/json:
              example:
                flowId: 550e8400-e29b-41d4-a716-446655440000
                trackingId: FAC-2025-001
                status: submitted
                sha256: a3d2c1b4e5f6789...
                name: Facture FAC-2025-001
                flowSyntax: CII
                flowProfile: EN16931
          description: Flux soumis avec succ√®s
        "400":
          content:
            application/json:
              examples:
                no_pdp_config:
                  summary: Aucune configuration PDP fournie
                  value:
                    detail:
                      error: no_pdp_config
                      message: Aucune configuration PDP fournie
                      help: |-
                        Vous devez soit :
                        1. Avoir un client_uid dans votre JWT (strat√©gie A)
                        2. Fournir pdp_credentials dans la requ√™te (strat√©gie B)
                invalid_pdf:
                  summary: Fichier PDF invalide
                  value:
                    detail: Le fichier n'est pas un PDF/A-3 valide
          description: Requ√™te invalide ou configuration PDP manquante
        "401":
          description: Non authentifi√© - Token JWT manquant ou invalide
        "403":
          description: Non autoris√© - Quota d√©pass√© ou permissions insuffisantes
        "404":
          content:
            application/json:
              example:
                detail:
                  error: client_not_found
                  message: Le client 550e8400-e29b-41d4-a716-446655440000 n'existe
                    pas
                  client_uid: 550e8400-e29b-41d4-a716-446655440000
          description: Client PDP non trouv√© (client_uid invalide)
        "429":
          description: Trop de requ√™tes - Rate limit atteint (30 soumissions/minute)
      summary: Soumettre un flux de facturation
      tags:
      - AFNOR PDP/PA - Flow Service
      x-accepts:
      - application/json
  /api/v1/afnor/flow/v1/flows/search:
    post:
      description: Rechercher des flux de facturation selon des crit√®res (utilise
        le client_uid du JWT)
      operationId: search_flows_proxy_api_v1_afnor_flow_v1_flows_search_post
      responses:
        "200":
          content:
            application/json:
              example:
                flows:
                - flowId: 550e8400-e29b-41d4-a716-446655440000
                  trackingId: FAC-2025-001
                  status: submitted
                  submittedAt: 2025-01-05T10:00:00Z
                total: 1
                offset: 0
                limit: 10
              schema: {}
          description: R√©sultats de recherche
        "400":
          content:
            application/json:
              example:
                detail:
                  error: no_pdp_config
                  message: Aucune configuration PDP fournie
                  help: Ajoutez un client_uid dans votre JWT
          description: Configuration PDP manquante
        "401":
          description: Non authentifi√© - Token JWT manquant ou invalide
        "404":
          description: Client PDP non trouv√© (client_uid invalide)
        "429":
          description: Trop de requ√™tes - Rate limit atteint (60 recherches/minute)
      summary: Rechercher des flux
      tags:
      - AFNOR PDP/PA - Flow Service
      x-accepts:
      - application/json
  /api/v1/afnor/flow/v1/flows/{flowId}:
    get:
      description: T√©l√©charger le fichier PDF/A-3 d'un flux de facturation (utilise
        le client_uid du JWT)
      operationId: download_flow_proxy_api_v1_afnor_flow_v1_flows__flowId__get
      parameters:
      - explode: false
        in: path
        name: flowId
        required: true
        schema:
          title: Flowid
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema: {}
            application/pdf:
              schema:
                format: binary
                type: string
          description: Fichier PDF/A-3
        "400":
          content:
            application/json:
              example:
                detail:
                  error: no_pdp_config
                  message: Aucune configuration PDP fournie
          description: Configuration PDP manquante
        "401":
          description: Non authentifi√© - Token JWT manquant ou invalide
        "404":
          content:
            application/json:
              examples:
                flow_not_found:
                  summary: Flux inexistant
                  value:
                    detail: Flux 550e8400-... non trouv√©
                client_not_found:
                  summary: Client PDP invalide
                  value:
                    detail:
                      error: client_not_found
                      message: Le client 550e8400-... n'existe pas
          description: Flux non trouv√© ou client_uid invalide
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      summary: T√©l√©charger un flux
      tags:
      - AFNOR PDP/PA - Flow Service
      x-accepts:
      - application/json
      - application/pdf
  /api/v1/afnor/directory/v1/healthcheck:
    get:
      description: V√©rifier la disponibilit√© du Directory Service
      operationId: directory_healthcheck_proxy_api_v1_afnor_directory_v1_healthcheck_get
      responses:
        "200":
          content:
            application/json:
              example:
                status: ok
                service: Directory Service
              schema: {}
          description: Service op√©rationnel
      summary: Healthcheck Directory Service
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/siren/search:
    post:
      description: Recherche multi-crit√®res d'entreprises (unit√©s l√©gales)
      operationId: search_siren_proxy_api_v1_afnor_directory_v1_siren_search_post
      responses:
        "200":
          content:
            application/json:
              example:
                data:
                - siren: "123456789"
                  businessName: ACME Corporation
                  entityType: PM
                  administrativeStatus: A
                meta:
                  total: 1
                  offset: 0
                  limit: 10
              schema: {}
          description: Retourne une ou plusieurs entreprises
        "401":
          description: Non authentifi√©
      security:
      - HTTPBearer: []
      summary: SIREN search (or legal unit)
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/siren/code-insee:{siren}:
    get:
      description: Retourne les d√©tails d'une entreprise (unit√© l√©gale) identifi√©e
        par son num√©ro SIREN
      operationId: get_siren_by_code_insee_proxy_api_v1_afnor_directory_v1_siren_code_insee__siren__get
      parameters:
      - explode: false
        in: path
        name: siren
        required: true
        schema:
          title: Siren
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                siren: "123456789"
                businessName: ACME Corporation
                entityType: PM
                administrativeStatus: A
              schema: {}
          description: Informations de l'entreprise
        "404":
          description: Entreprise non trouv√©e
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Consult a siren (legal unit) by SIREN number
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/siren/id-instance:{id_instance}:
    get:
      description: Obtenir une entreprise (unit√© l√©gale) identifi√©e par son idInstance
      operationId: get_siren_by_id_instance_proxy_api_v1_afnor_directory_v1_siren_id_instance__id_instance__get
      parameters:
      - explode: false
        in: path
        name: id_instance
        required: true
        schema:
          title: Id Instance
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                siren: "123456789"
                businessName: ACME Corporation
                idInstance: 550e8400-e29b-41d4-a716-446655440000
              schema: {}
          description: Informations de l'entreprise
        "404":
          description: Entreprise non trouv√©e
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Gets a siren (legal unit) by instance ID
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/siret/search:
    post:
      description: Recherche multi-crit√®res d'√©tablissements
      operationId: search_siret_proxy_api_v1_afnor_directory_v1_siret_search_post
      responses:
        "200":
          content:
            application/json:
              example:
                data:
                - siret: "12345678901234"
                  siren: "123456789"
                  name: ACME Corporation - Si√®ge
                  facilityType: SIEGE
                meta:
                  total: 1
                  offset: 0
                  limit: 10
              schema: {}
          description: Retourne un ou plusieurs √©tablissements
        "401":
          description: Non authentifi√©
      security:
      - HTTPBearer: []
      summary: Search for a SIRET (facility)
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/siret/code-insee:{siret}:
    get:
      description: Obtenir un √©tablissement identifi√© par son num√©ro SIRET
      operationId: get_siret_by_code_insee_proxy_api_v1_afnor_directory_v1_siret_code_insee__siret__get
      parameters:
      - explode: false
        in: path
        name: siret
        required: true
        schema:
          title: Siret
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                siret: "12345678901234"
                siren: "123456789"
                name: ACME Corporation - Si√®ge
                facilityType: SIEGE
              schema: {}
          description: Informations de l'√©tablissement
        "404":
          description: √âtablissement non trouv√©
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Gets a siret (facility) by SIRET number
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/siret/id-instance:{id_instance}:
    get:
      description: Obtenir un √©tablissement identifi√© par son idInstance
      operationId: get_siret_by_id_instance_proxy_api_v1_afnor_directory_v1_siret_id_instance__id_instance__get
      parameters:
      - explode: false
        in: path
        name: id_instance
        required: true
        schema:
          title: Id Instance
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                siret: "12345678901234"
                siren: "123456789"
                idInstance: 550e8400-e29b-41d4-a716-446655440000
              schema: {}
          description: Informations de l'√©tablissement
        "404":
          description: √âtablissement non trouv√©
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Gets a siret (facility) by id-instance
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/routing-code:
    post:
      description: Cr√©er un code de routage dans l'annuaire
      operationId: create_routing_code_proxy_api_v1_afnor_directory_v1_routing_code_post
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "201":
          description: Code de routage cr√©√© avec succ√®s
        "400":
          description: Requ√™te invalide
        "401":
          description: Non authentifi√©
      security:
      - HTTPBearer: []
      summary: Create a routing code
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/routing-code/search:
    post:
      description: Rechercher des codes de routage selon des crit√®res
      operationId: search_routing_code_proxy_api_v1_afnor_directory_v1_routing_code_search_post
      responses:
        "200":
          content:
            application/json:
              example:
                data:
                - siret: "12345678901234"
                  routingIdentifier: SERVICE01
                  idInstance: 550e8400-e29b-41d4-a716-446655440000
                meta:
                  total: 1
                  offset: 0
                  limit: 10
              schema: {}
          description: R√©sultats de recherche
        "401":
          description: Non authentifi√©
      security:
      - HTTPBearer: []
      summary: Search for a routing code
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/routing-code/siret:{siret}/code:{routing_identifier}:
    get:
      description: Consulter un code de routage identifi√© par SIRET et identifiant
        de routage
      operationId: get_routing_code_by_siret_and_code_proxy_api_v1_afnor_directory_v1_routing_code_siret__siret__code__routing_identifier__get
      parameters:
      - explode: false
        in: path
        name: siret
        required: true
        schema:
          title: Siret
          type: string
        style: simple
      - explode: false
        in: path
        name: routing_identifier
        required: true
        schema:
          title: Routing Identifier
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                siret: "12345678901234"
                routingIdentifier: SERVICE01
                idInstance: 550e8400-e29b-41d4-a716-446655440000
              schema: {}
          description: D√©tails du code de routage
        "404":
          description: Code de routage non trouv√©
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Get a routing code by SIRET and routing identifier
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/routing-code/id-instance:{id_instance}:
    get:
      description: Obtenir un code de routage identifi√© par son idInstance
      operationId: get_routing_code_by_id_instance_proxy_api_v1_afnor_directory_v1_routing_code_id_instance__id_instance__get
      parameters:
      - explode: false
        in: path
        name: id_instance
        required: true
        schema:
          title: Id Instance
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                siret: "12345678901234"
                routingIdentifier: SERVICE01
                idInstance: 550e8400-e29b-41d4-a716-446655440000
              schema: {}
          description: D√©tails du code de routage
        "404":
          description: Code de routage non trouv√©
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Get a routing code by instance-id
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
    patch:
      description: Mettre √† jour partiellement un code de routage priv√©
      operationId: patch_routing_code_proxy_api_v1_afnor_directory_v1_routing_code_id_instance__id_instance__patch
      parameters:
      - explode: false
        in: path
        name: id_instance
        required: true
        schema:
          title: Id Instance
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Code de routage mis √† jour
        "404":
          description: Code de routage non trouv√©
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Partially update a private routing code
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
    put:
      description: Mettre √† jour compl√®tement un code de routage priv√©
      operationId: put_routing_code_proxy_api_v1_afnor_directory_v1_routing_code_id_instance__id_instance__put
      parameters:
      - explode: false
        in: path
        name: id_instance
        required: true
        schema:
          title: Id Instance
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Code de routage mis √† jour
        "404":
          description: Code de routage non trouv√©
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Completely update a private routing code
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/directory-line:
    post:
      description: Cr√©er une ligne dans l'annuaire
      operationId: create_directory_line_proxy_api_v1_afnor_directory_v1_directory_line_post
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "201":
          description: Ligne d'annuaire cr√©√©e avec succ√®s
        "400":
          description: Requ√™te invalide
        "401":
          description: Non authentifi√©
      security:
      - HTTPBearer: []
      summary: Creating a directory line
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/directory-line/search:
    post:
      description: Rechercher des lignes d'annuaire selon des crit√®res
      operationId: search_directory_line_proxy_api_v1_afnor_directory_v1_directory_line_search_post
      responses:
        "200":
          content:
            application/json:
              example:
                data:
                - addressingIdentifier: 123456789_12345678901234_SERVICE01
                  siren: "123456789"
                  siret: "12345678901234"
                  routingIdentifier: SERVICE01
                meta:
                  total: 1
                  offset: 0
                  limit: 10
              schema: {}
          description: R√©sultats de recherche
        "401":
          description: Non authentifi√©
      security:
      - HTTPBearer: []
      summary: Search for a directory line
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/directory-line/code:{addressing_identifier}:
    get:
      description: Obtenir une ligne d'annuaire identifi√©e par un identifiant d'adressage
      operationId: get_directory_line_by_code_proxy_api_v1_afnor_directory_v1_directory_line_code__addressing_identifier__get
      parameters:
      - explode: false
        in: path
        name: addressing_identifier
        required: true
        schema:
          title: Addressing Identifier
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                addressingIdentifier: 123456789_12345678901234_SERVICE01
                siren: "123456789"
                siret: "12345678901234"
                routingIdentifier: SERVICE01
              schema: {}
          description: D√©tails de la ligne d'annuaire
        "404":
          description: Ligne d'annuaire non trouv√©e
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Get a directory line
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/afnor/directory/v1/directory-line/id-instance:{id_instance}:
    delete:
      description: Supprimer une ligne d'annuaire
      operationId: delete_directory_line_proxy_api_v1_afnor_directory_v1_directory_line_id_instance__id_instance__delete
      parameters:
      - explode: false
        in: path
        name: id_instance
        required: true
        schema:
          title: Id Instance
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "204":
          description: Ligne d'annuaire supprim√©e
        "404":
          description: Ligne d'annuaire non trouv√©e
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Delete a directory line
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
    get:
      description: Obtenir une ligne d'annuaire identifi√©e par son idInstance
      operationId: get_directory_line_by_id_instance_proxy_api_v1_afnor_directory_v1_directory_line_id_instance__id_instance__get
      parameters:
      - explode: false
        in: path
        name: id_instance
        required: true
        schema:
          title: Id Instance
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              example:
                addressingIdentifier: 123456789_12345678901234_SERVICE01
                siren: "123456789"
                siret: "12345678901234"
                idInstance: 550e8400-e29b-41d4-a716-446655440000
              schema: {}
          description: D√©tails de la ligne d'annuaire
        "404":
          description: Ligne d'annuaire non trouv√©e
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Get a directory line
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
    patch:
      description: Mettre √† jour partiellement une ligne d'annuaire
      operationId: patch_directory_line_proxy_api_v1_afnor_directory_v1_directory_line_id_instance__id_instance__patch
      parameters:
      - explode: false
        in: path
        name: id_instance
        required: true
        schema:
          title: Id Instance
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Ligne d'annuaire mise √† jour
        "404":
          description: Ligne d'annuaire non trouv√©e
        "401":
          description: Non authentifi√©
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Partially updates a directory line
      tags:
      - AFNOR PDP/PA - Directory Service
      x-accepts:
      - application/json
  /api/v1/chorus-pro/structures/rechercher:
    post:
      description: |-
        Recherche des structures (entreprises, administrations) enregistr√©es sur Chorus Pro.

            **Cas d'usage** :
            - Trouver l'ID Chorus Pro d'une structure √† partir de son SIRET
            - V√©rifier si une structure est enregistr√©e sur Chorus Pro
            - Lister les structures correspondant √† des crit√®res

            **Filtres disponibles** :
            - Identifiant (SIRET, SIREN, etc.)
            - Raison sociale
            - Type d'identifiant
            - Structures priv√©es uniquement

            **√âtape typique** : Appel√©e avant `soumettre-facture` pour obtenir l'`id_structure_cpp` du destinataire.
      operationId: rechercher_structures_api_v1_chorus_pro_structures_rechercher_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RechercherStructureRequest"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RechercherStructureResponse"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Rechercher des structures Chorus Pro
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/structures/consulter:
    post:
      description: |-
        R√©cup√®re les informations d√©taill√©es d'une structure Chorus Pro.


            **Retour** :
            - Raison sociale
            - Num√©ro de TVA intracommunautaire
            - Email de contact
            - **Param√®tres obligatoires** : Indique si le code service et/ou num√©ro d'engagement sont requis pour soumettre une facture

            **√âtape typique** : Appel√©e apr√®s `rechercher-structures` pour savoir quels champs sont obligatoires avant de soumettre une facture.
      operationId: consulter_structure_api_v1_chorus_pro_structures_consulter_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConsulterStructureRequest"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsulterStructureResponse"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Consulter les d√©tails d'une structure
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/structures/{id_structure_cpp}/services:
    get:
      description: |-
        R√©cup√®re la liste des services actifs d'une structure publique.

            **Cas d'usage** :
            - Lister les services disponibles pour une administration
            - V√©rifier qu'un code service existe avant de soumettre une facture

            **Retour** :
            - Liste des services avec leur code, libell√© et statut (actif/inactif)
      operationId: lister_services_structure_api_v1_chorus_pro_structures__id_structure_cpp__services_get
      parameters:
      - explode: false
        in: path
        name: id_structure_cpp
        required: true
        schema:
          title: Id Structure Cpp
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RechercherServicesResponse"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Lister les services d'une structure
      tags:
      - Chorus Pro
      x-accepts:
      - application/json
  /api/v1/chorus-pro/structures/obtenir-id-depuis-siret:
    post:
      description: |-
        **Utilitaire pratique** pour obtenir l'ID Chorus Pro d'une structure √† partir de son SIRET.


            Cette fonction wrapper combine :
            1. Recherche de la structure par SIRET
            2. Extraction de l'`id_structure_cpp` si une seule structure est trouv√©e

            **Retour** :
            - `id_structure_cpp` : ID Chorus Pro (0 si non trouv√© ou si plusieurs r√©sultats)
            - `designation_structure` : Nom de la structure (si trouv√©e)
            - `message` : Message explicatif

            **Cas d'usage** :
            - Raccourci pour obtenir directement l'ID Chorus Pro avant de soumettre une facture
            - Alternative simplifi√©e √† `rechercher-structures` + extraction manuelle de l'ID

            **Note** : Si plusieurs structures correspondent au SIRET (rare), retourne 0 et un message d'erreur.
      operationId: obtenir_id_chorus_pro_depuis_siret_api_v1_chorus_pro_structures_obtenir_id_depuis_siret_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ObtenirIdChorusProRequest"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ObtenirIdChorusProResponse"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: "Utilitaire : Obtenir l'ID Chorus Pro depuis un SIRET"
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/soumettre:
    post:
      description: |-
        Soumet une facture √©lectronique √† une structure publique via Chorus Pro.


            **üìã Workflow complet** :
            1. **Uploader le PDF Factur-X** via `/transverses/ajouter-fichier` ‚Üí r√©cup√©rer `pieceJointeId`
            2. **Obtenir l'ID structure** via `/structures/rechercher` ou `/structures/obtenir-id-depuis-siret`
            3. **V√©rifier les param√®tres obligatoires** via `/structures/consulter`
            4. **Soumettre la facture** avec le `piece_jointe_principale_id` obtenu √† l'√©tape 1

            **Pr√©-requis** :
            1. Avoir l'`id_structure_cpp` du destinataire (via `/structures/rechercher`)
            2. Conna√Ætre les param√®tres obligatoires (via `/structures/consulter`) :
               - Code service si `code_service_doit_etre_renseigne=true`
               - Num√©ro d'engagement si `numero_ej_doit_etre_renseigne=true`
            3. Avoir upload√© le PDF Factur-X (via `/transverses/ajouter-fichier`)

            **Format attendu** :
            - `piece_jointe_principale_id` : ID retourn√© par `/transverses/ajouter-fichier`
            - Montants : Cha√Ænes de caract√®res avec 2 d√©cimales (ex: "1250.50")
            - Dates : Format ISO 8601 (YYYY-MM-DD)

            **Retour** :
            - `identifiant_facture_cpp` : ID Chorus Pro de la facture cr√©√©e
            - `numero_flux_depot` : Num√©ro de suivi du d√©p√¥t

            **Statuts possibles apr√®s soumission** :
            - SOUMISE : En attente de validation
            - VALIDEE : Valid√©e par le destinataire
            - REJETEE : Rejet√©e (erreur de donn√©es ou refus m√©tier)
            - SUSPENDUE : En attente d'informations compl√©mentaires

            **Note** : Utilisez `/factures/consulter` pour suivre l'√©volution du statut.
      operationId: soumettre_facture_api_v1_chorus_pro_factures_soumettre_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SoumettreFactureRequest"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SoumettreFactureResponse"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Soumettre une facture √† Chorus Pro
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/consulter:
    post:
      description: |-
        R√©cup√®re les informations et le statut actuel d'une facture soumise √† Chorus Pro.

            **Retour** :
            - Num√©ro et date de facture
            - Montant TTC
            - **Statut courant** : SOUMISE, VALIDEE, REJETEE, SUSPENDUE, MANDATEE, MISE_EN_PAIEMENT, etc.
            - Structure destinataire

            **Cas d'usage** :
            - Suivre l'√©volution du traitement d'une facture
            - V√©rifier si une facture a √©t√© valid√©e ou rejet√©e
            - Obtenir la date de mise en paiement

            **Polling** : Appelez cet endpoint r√©guli√®rement pour suivre l'√©volution du statut.
      operationId: consulter_facture_api_v1_chorus_pro_factures_consulter_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConsulterFactureRequest"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsulterFactureResponse"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Consulter le statut d'une facture
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/rechercher-fournisseur:
    post:
      description: |-
        Recherche les factures √©mises par le fournisseur connect√©.

            **Filtres disponibles** :
            - Num√©ro de facture
            - Dates (d√©but/fin)
            - Statut
            - Structure destinataire
            - Montant

            **Cas d'usage** :
            - Suivi des factures √©mises
            - V√©rification des statuts
            - Export pour comptabilit√©
      operationId: rechercher_factures_fournisseur_api_v1_chorus_pro_factures_rechercher_fournisseur_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: {}
              title: Payload
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Rechercher factures √©mises (Fournisseur)
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/rechercher-destinataire:
    post:
      description: |-
        Recherche les factures re√ßues par le destinataire connect√©.

            **Filtres** :
            - T√©l√©charg√©e / non t√©l√©charg√©e
            - Dates de r√©ception
            - Statut (MISE_A_DISPOSITION, SUSPENDUE, etc.)
            - Fournisseur

            **Indicateur utile** : `factureTelechargeeParDestinataire` permet de savoir si la facture a d√©j√† √©t√© t√©l√©charg√©e.
      operationId: rechercher_factures_destinataire_api_v1_chorus_pro_factures_rechercher_destinataire_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: true
              title: Payload
              type: object
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Rechercher factures re√ßues (Destinataire)
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/telecharger-groupe:
    post:
      description: |-
        T√©l√©charge une ou plusieurs factures (max 10 recommand√©) avec leurs pi√®ces jointes.

            **Formats disponibles** :
            - PDF : Fichier PDF uniquement
            - XML : Fichier XML uniquement
            - ZIP : Archive contenant PDF + XML + pi√®ces jointes

            **Taille maximale** : 120 Mo par t√©l√©chargement

            **Payload exemple** :
            ```json
            {
              "listeIdentifiantsFactureCPP": [12345, 12346],
              "inclurePiecesJointes": true,
              "formatFichier": "ZIP"
            }
            ```

            **Retour** : Le fichier est encod√© en base64 dans le champ `fichierBase64`.

            **Note** : Le flag `factureTelechargeeParDestinataire` est mis √† jour automatiquement.
      operationId: telecharger_groupe_factures_api_v1_chorus_pro_factures_telecharger_groupe_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: true
              title: Payload
              type: object
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: T√©l√©charger un groupe de factures
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/traiter-facture-recue:
    post:
      description: |-
        Change le statut d'une facture re√ßue.

            **Statuts possibles** :
            - MISE_A_DISPOSITION : Facture accept√©e
            - SUSPENDUE : En attente d'informations compl√©mentaires (motif obligatoire)
            - REJETEE : Facture refus√©e (motif obligatoire)
            - MANDATEE : Facture mandat√©e
            - MISE_EN_PAIEMENT : Facture en cours de paiement
            - COMPTABILISEE : Facture comptabilis√©e
            - MISE_A_DISPOSITION_COMPTABLE : Mise √† disposition comptable
            - A_RECYCLER : √Ä recycler
            - COMPLETEE : Compl√©t√©e
            - SERVICE-FAIT : Service fait
            - PRISE_EN_COMPTE_DESTINATAIRE : Prise en compte
            - TRANSMISE_MOA : Transmise √† la MOA

            **Payload exemple** :
            ```json
            {
              "identifiantFactureCPP": 12345,
              "nouveauStatut": "REJETEE",
              "motifRejet": "Facture en double",
              "commentaire": "Facture d√©j√† re√ßue sous la r√©f√©rence ABC123"
            }
            ```

            **R√®gles** :
            - Un motif est **obligatoire** pour SUSPENDUE et REJETEE
            - Seuls certains statuts sont autoris√©s selon le statut actuel de la facture
      operationId: traiter_facture_recue_api_v1_chorus_pro_factures_traiter_facture_recue_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: true
              title: Payload
              type: object
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Traiter une facture re√ßue (Destinataire)
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/recycler:
    post:
      description: |-
        Recycle une facture au statut A_RECYCLER en modifiant les donn√©es d'acheminement.

            **Statut requis** : A_RECYCLER

            **Champs modifiables** :
            - Destinataire (`idStructureCPP`)
            - Code service
            - Num√©ro d'engagement

            **Cas d'usage** :
            - Erreur de destinataire
            - Changement de service facturation
            - Mise √† jour du num√©ro d'engagement

            **Payload exemple** :
            ```json
            {
              "identifiantFactureCPP": 12345,
              "idStructureCPP": 67890,
              "codeService": "SERVICE_01",
              "numeroEngagement": "ENG2024001"
            }
            ```

            **Note** : La facture conserve son num√©ro et ses montants, seuls les champs d'acheminement changent.
      operationId: recycler_facture_api_v1_chorus_pro_factures_recycler_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: true
              title: Payload
              type: object
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Recycler une facture (Fournisseur)
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/completer:
    post:
      description: |-
        Compl√®te une facture au statut SUSPENDUE en ajoutant des pi√®ces jointes ou un commentaire.

            **Statut requis** : SUSPENDUE

            **Actions possibles** :
            - Ajouter des pi√®ces jointes (justificatifs, bons de commande, etc.)
            - Modifier le commentaire

            **Payload exemple** :
            ```json
            {
              "identifiantFactureCPP": 12345,
              "commentaire": "Voici les justificatifs demand√©s",
              "listePiecesJointes": [
                {
                  "pieceJointeIdFichier": 98765,
                  "pieceJointeNom": "bon_commande.pdf"
                }
              ]
            }
            ```

            **Note** : Les pi√®ces jointes doivent d'abord √™tre upload√©es via `/transverses/ajouter-fichier`.

            **Apr√®s compl√©tion** : La facture repasse au statut MISE_A_DISPOSITION.
      operationId: completer_facture_api_v1_chorus_pro_factures_completer_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: true
              title: Payload
              type: object
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Compl√©ter une facture suspendue (Fournisseur)
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/valideur/rechercher:
    post:
      description: |-
        Recherche les factures en attente de validation par le valideur connect√©.

            **R√¥le** : Valideur dans le circuit de validation interne.

            **Filtres** : Dates, structure, service, etc.
      operationId: valideur_rechercher_factures_api_v1_chorus_pro_factures_valideur_rechercher_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: true
              title: Payload
              type: object
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Rechercher factures √† valider (Valideur)
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/valideur/consulter:
    post:
      operationId: valideur_consulter_facture_api_v1_chorus_pro_factures_valideur_consulter_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: true
              title: Payload
              type: object
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Consulter une facture (Valideur)
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/factures/valideur/traiter:
    post:
      description: |-
        Valide ou refuse une facture en attente de validation.

            **Actions** :
            - Valider : La facture passe au statut suivant du circuit
            - Refuser : La facture est rejet√©e (motif obligatoire)
      operationId: valideur_traiter_facture_api_v1_chorus_pro_factures_valideur_traiter_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: true
              title: Payload
              type: object
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Valider ou refuser une facture (Valideur)
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/chorus-pro/transverses/ajouter-fichier:
    post:
      description: |-
        Ajoute une pi√®ce jointe au compte utilisateur courant.

            **Taille max** : 10 Mo par fichier

            **Payload exemple** :
            ```json
            {
              "pieceJointeFichier": "JVBERi0xLjQKJeLjz9MKNSAwIG9iago8P...",
              "pieceJointeNom": "bon_commande.pdf",
              "pieceJointeTypeMime": "application/pdf",
              "pieceJointeExtension": "PDF"
            }
            ```

            **Retour** : L'ID de la pi√®ce jointe (`pieceJointeIdFichier`) √† utiliser ensuite dans `/factures/completer`.

            **Extensions accept√©es** : PDF, JPG, PNG, ZIP, XML, etc.
      operationId: ajouter_fichier_api_v1_chorus_pro_transverses_ajouter_fichier_post
      requestBody:
        content:
          application/json:
            schema:
              additionalProperties: true
              title: Payload
              type: object
        required: true
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Ajouter une pi√®ce jointe
      tags:
      - Chorus Pro
      x-content-type: application/json
      x-accepts:
      - application/json
  /api/v1/verification/verifier:
    post:
      description: |-
        V√©rifie la conformit√© entre le PDF et son XML Factur-X embarqu√©.

        **IMPORTANT**: Seuls les PDF Factur-X (avec XML embarqu√©) sont accept√©s.
        Les PDF sans XML Factur-X seront rejet√©s avec une erreur 400.

        Cette version synchrone utilise uniquement l'extraction PDF native (pdfplumber).
        Pour les PDF images n√©cessitant de l'OCR, utilisez l'endpoint `/verifier-async`.

        **Principe de v√©rification (Factur-X 1.08):**
        - Principe n¬∞2: Le XML ne peut contenir que des infos pr√©sentes dans le PDF
        - Principe n¬∞4: Toute info XML doit √™tre pr√©sente et conforme dans le PDF

        **Champs v√©rifi√©s:**
        - Identification: BT-1 (n¬∞ facture), BT-2 (date), BT-3 (type), BT-5 (devise), BT-23 (cadre)
        - Vendeur: BT-27 (nom), BT-29 (SIRET), BT-30 (SIREN), BT-31 (TVA)
        - Acheteur: BT-44 (nom), BT-46 (SIRET), BT-47 (SIREN), BT-48 (TVA)
        - Montants: BT-109 (HT), BT-110 (TVA), BT-112 (TTC), BT-115 (√† payer)
        - Ventilation TVA: BT-116, BT-117, BT-118, BT-119
        - Lignes de facture: BT-153, BT-129, BT-146, BT-131
        - Notes obligatoires: PMT, PMD, AAB
        - R√®gle BR-FR-09: coh√©rence SIRET/SIREN
      operationId: verifier_pdf_sync_api_v1_verification_verifier_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/Body_verifier_pdf_sync_api_v1_verification_verifier_post"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReponseVerificationSucces"
          description: V√©rification r√©ussie
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/APIError"
          description: "Erreur de v√©rification (PDF non Factur-X, invalide, etc.)"
        "413":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/APIError"
          description: PDF trop volumineux ou trop de pages
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: V√©rifier la conformit√© PDF/XML Factur-X (synchrone)
      tags:
      - V√©rification PDF/XML
      - V√©rification PDF/XML
      x-content-type: multipart/form-data
      x-accepts:
      - application/json
  /api/v1/verification/verifier-async:
    post:
      description: |-
        V√©rifie la conformit√© PDF/XML Factur-X de mani√®re asynchrone.

        **IMPORTANT**: Seuls les PDF Factur-X (avec XML embarqu√©) sont accept√©s.
        Les PDF sans XML Factur-X retourneront une erreur `NOT_FACTURX` dans le r√©sultat.

        Cette version utilise une t√¢che Celery et peut faire appel au service OCR
        si le PDF est une image ou si `forcer_ocr=true`.

        **Retourne imm√©diatement** un ID de t√¢che. Utilisez `/verifier-async/{id_tache}/statut`
        pour r√©cup√©rer le r√©sultat.

        **Principe de v√©rification (Factur-X 1.08):**
        - Principe n¬∞2: Le XML ne peut contenir que des infos pr√©sentes dans le PDF
        - Principe n¬∞4: Toute info XML doit √™tre pr√©sente et conforme dans le PDF

        **Champs v√©rifi√©s:**
        - Identification: BT-1 (n¬∞ facture), BT-2 (date), BT-3 (type), BT-5 (devise), BT-23 (cadre)
        - Vendeur: BT-27 (nom), BT-29 (SIRET), BT-30 (SIREN), BT-31 (TVA)
        - Acheteur: BT-44 (nom), BT-46 (SIRET), BT-47 (SIREN), BT-48 (TVA)
        - Montants: BT-109 (HT), BT-110 (TVA), BT-112 (TTC), BT-115 (√† payer)
        - Ventilation TVA: BT-116, BT-117, BT-118, BT-119
        - Lignes de facture: BT-153, BT-129, BT-146, BT-131
        - Notes obligatoires: PMT, PMD, AAB
        - R√®gle BR-FR-09: coh√©rence SIRET/SIREN

        **Avantages par rapport √† la version synchrone:**
        - Support OCR pour les PDF images (via service DocTR)
        - Timeout plus long pour les gros documents
        - Ne bloque pas le serveur
      operationId: verifier_pdf_async_api_v1_verification_verifier_async_post
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/Body_verifier_pdf_async_api_v1_verification_verifier_async_post"
        required: true
      responses:
        "202":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReponseTache"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: V√©rifier la conformit√© PDF/XML Factur-X (asynchrone)
      tags:
      - V√©rification PDF/XML
      - V√©rification PDF/XML
      x-content-type: multipart/form-data
      x-accepts:
      - application/json
  /api/v1/verification/verifier-async/{id_tache}/statut:
    get:
      description: |-
        R√©cup√®re le statut et le r√©sultat d'une t√¢che de v√©rification asynchrone.

        **Statuts possibles:**
        - `PENDING`: T√¢che en attente dans la file
        - `STARTED`: T√¢che en cours d'ex√©cution
        - `SUCCESS`: T√¢che termin√©e avec succ√®s (voir `resultat`)
        - `FAILURE`: Erreur syst√®me (exception non g√©r√©e)

        **Note:** Le champ `resultat.statut` peut √™tre "SUCCES" ou "ERREUR"
        ind√©pendamment du statut Celery (qui sera toujours SUCCESS si la t√¢che s'est ex√©cut√©e).
      operationId: obtenir_statut_verification_api_v1_verification_verifier_async__id_tache__statut_get
      parameters:
      - explode: false
        in: path
        name: id_tache
        required: true
        schema:
          title: Id Tache
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatutTache"
          description: Successful Response
        "422":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Obtenir le statut d'une v√©rification asynchrone
      tags:
      - V√©rification PDF/XML
      - V√©rification PDF/XML
      x-accepts:
      - application/json
  /:
    get:
      description: |-
        Endpoint de health check pour v√©rifier que l'API r√©pond.

        Utile pour :
        - Monitoring de disponibilit√©
        - Tests d'int√©gration
        - Load balancers
      operationId: racine__get
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: L'API est op√©rationnelle
      summary: V√©rifier l'√©tat de l'API
      tags:
      - Sant√©
      x-accepts:
      - application/json
  /healthcheck:
    get:
      description: |-
        Endpoint de healthcheck pour Docker et les load balancers.

        Utile pour :
        - Docker healthcheck
        - Kubernetes liveness/readiness probes
        - Load balancers (Nginx, HAProxy)
        - Monitoring de disponibilit√©
        - D√©ploiement zero downtime

        Retourne un code 200 si l'API est op√©rationnelle.
      operationId: healthcheck_healthcheck_get
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: L'API est en bonne sant√©
      summary: Endpoint de healthcheck pour Docker
      tags:
      - Sant√©
      x-accepts:
      - application/json
  /api/v1/moi:
    get:
      description: |-
        Retourne les informations de l'utilisateur authentifi√©.

        Cet endpoint permet de :
        - V√©rifier que l'authentification fonctionne
        - Obtenir les d√©tails du compte connect√©
        - Tester la validit√© du token JWT
        - Consulter son quota de consommation

        **N√©cessite une authentification valide.**
      operationId: obtenir_infos_utilisateur_api_v1_moi_get
      responses:
        "200":
          content:
            application/json:
              schema: {}
          description: Informations de l'utilisateur
      security:
      - HTTPBearer: []
      summary: Obtenir les informations de l'utilisateur connect√©
      tags:
      - Utilisateur
      x-accepts:
      - application/json
components:
  schemas:
    APIError:
      description: |-
        Erreur API standardis√©e (align√©e sur AFNOR Error schema).

        Format unifi√© pour toutes les r√©ponses d'erreur HTTP.
      example:
        details:
        - code: SCHEMATRON_BR_FR_01
          item: BR-FR-01
          level: Error
          reason: Le SIRET du fournisseur est obligatoire pour les factures fran√ßaises
          source: schematron
        errorCode: VALIDATION_FAILED
        errorMessage: La validation Factur-X a √©chou√©
      properties:
        errorCode:
          description: Code alphanum√©rique identifiant pr√©cis√©ment l'erreur
          title: Errorcode
          type: string
        errorMessage:
          description: Message d√©crivant l'erreur (non destin√© √† l'utilisateur final)
          title: Errormessage
          type: string
        details:
          items:
            $ref: "#/components/schemas/ValidationErrorDetail"
          nullable: true
          type: array
      required:
      - errorCode
      - errorMessage
      title: APIError
    AdresseElectronique:
      description: |-
        Repr√©sente une adresse de facturation √©lectronique, compos√©e d'un identifiant
        et de son sch√©ma (SchemeID) conform√©ment √† la norme EN16931.
        Exemple: { "identifiant": "123456789", "scheme_id": "0225" }
      properties:
        identifiant:
          title: Identifiant
          type: string
        schemeId:
          allOf:
          - $ref: "#/components/schemas/SchemeID"
          default: "0225"
      required:
      - identifiant
      title: AdresseElectronique
    AdressePostale:
      description: Repr√©sente une adresse postale.
      properties:
        codePostal:
          nullable: true
          type: string
        ligneUn:
          nullable: true
          type: string
        ligneDeux:
          nullable: true
          type: string
        nomVille:
          nullable: true
          type: string
        paysCodeIso:
          nullable: true
          type: string
      title: AdressePostale
    Body_generer_facture_api_v1_traitement_generer_facture_post:
      properties:
        donnees_facture:
          description: "Donn√©es de la facture au format JSON.\n\n            Deux\
            \ formats accept√©s :\n            1. **Format classique** : Structure\
            \ compl√®te FactureFacturX (tous les champs)\n            2. **Format simplifi√©\
            ** (üÜï P0.1) : Structure minimale avec auto-enrichissement\n\n       \
            \     Le format est d√©tect√© automatiquement !\n            "
          title: Donnees Facture
          type: string
        profil:
          allOf:
          - $ref: "#/components/schemas/ProfilAPI"
          default: EXTENDED
          description: "Profil Factur-X : MINIMUM, BASIC, EN16931 ou EXTENDED."
        format_sortie:
          allOf:
          - $ref: "#/components/schemas/FormatSortie"
          default: xml
          description: "Format de sortie : 'xml' (XML seul) ou 'pdf' (PDF Factur-X\
            \ avec XML embarqu√©)."
        auto_enrichir:
          default: true
          description: üÜï Activer l'auto-enrichissement depuis SIRET/SIREN (format
            simplifi√© uniquement)
          title: Auto Enrichir
          type: boolean
        source_pdf:
          format: binary
          nullable: true
          type: string
      required:
      - donnees_facture
      title: Body_generer_facture_api_v1_traitement_generer_facture_post
    Body_signer_pdf_api_v1_traitement_signer_pdf_post:
      properties:
        fichier_pdf:
          description: Fichier PDF √† signer (sera trait√© puis retourn√© sign√© en base64)
          format: binary
          title: Fichier Pdf
          type: string
        raison:
          nullable: true
          type: string
        localisation:
          nullable: true
          type: string
        contact:
          nullable: true
          type: string
        field_name:
          default: FactPulseSignature
          description: Nom du champ de signature PDF
          example: FactPulseSignature
          title: Field Name
          type: string
        use_pades_lt:
          default: false
          description: Activer PAdES-B-LT (archivage long terme avec donn√©es de validation
            embarqu√©es). N√âCESSITE un certificat avec acc√®s OCSP/CRL.
          title: Use Pades Lt
          type: boolean
        use_timestamp:
          default: true
          description: Activer l'horodatage RFC 3161 avec FreeTSA (PAdES-B-T)
          title: Use Timestamp
          type: boolean
      required:
      - fichier_pdf
      title: Body_signer_pdf_api_v1_traitement_signer_pdf_post
    Body_signer_pdf_async_api_v1_traitement_signer_pdf_async_post:
      properties:
        fichier_pdf:
          description: Fichier PDF √† signer (trait√© de mani√®re asynchrone)
          format: binary
          title: Fichier Pdf
          type: string
        raison:
          nullable: true
          type: string
        localisation:
          nullable: true
          type: string
        contact:
          nullable: true
          type: string
        field_name:
          default: FactPulseSignature
          description: Nom du champ de signature PDF
          example: FactPulseSignature
          title: Field Name
          type: string
        use_pades_lt:
          default: false
          description: Activer PAdES-B-LT (archivage long terme avec donn√©es de validation
            embarqu√©es). N√âCESSITE un certificat avec acc√®s OCSP/CRL.
          title: Use Pades Lt
          type: boolean
        use_timestamp:
          default: true
          description: Activer l'horodatage RFC 3161 avec FreeTSA (PAdES-B-T)
          title: Use Timestamp
          type: boolean
      required:
      - fichier_pdf
      title: Body_signer_pdf_async_api_v1_traitement_signer_pdf_async_post
    Body_valider_pdf_facturx_api_v1_traitement_valider_pdf_facturx_post:
      properties:
        fichier_pdf:
          description: Fichier PDF Factur-X √† valider (format .pdf).
          format: binary
          title: Fichier Pdf
          type: string
        profil:
          allOf:
          - $ref: "#/components/schemas/ProfilAPI"
          nullable: true
        use_verapdf:
          default: false
          description: "Active la validation stricte PDF/A avec VeraPDF (recommand√©\
            \ pour la production). Si False, utilise une validation basique par m√©\
            tadonn√©es."
          title: Use Verapdf
          type: boolean
      required:
      - fichier_pdf
      title: Body_valider_pdf_facturx_api_v1_traitement_valider_pdf_facturx_post
    Body_valider_pdf_facturx_async_api_v1_traitement_valider_facturx_async_post:
      properties:
        fichier_pdf:
          description: Fichier PDF Factur-X √† valider (format .pdf).
          format: binary
          title: Fichier Pdf
          type: string
        profil:
          allOf:
          - $ref: "#/components/schemas/ProfilAPI"
          nullable: true
        use_verapdf:
          default: false
          description: Active la validation stricte PDF/A avec VeraPDF (recommand√©
            pour la production). Peut prendre plusieurs secondes.
          title: Use Verapdf
          type: boolean
      required:
      - fichier_pdf
      title: Body_valider_pdf_facturx_async_api_v1_traitement_valider_facturx_async_post
    Body_valider_signature_pdf_endpoint_api_v1_traitement_valider_signature_pdf_post:
      properties:
        fichier_pdf:
          description: Fichier PDF √† valider (sera analys√© pour d√©tecter et valider
            les signatures)
          format: binary
          title: Fichier Pdf
          type: string
      required:
      - fichier_pdf
      title: Body_valider_signature_pdf_endpoint_api_v1_traitement_valider_signature_pdf_post
    Body_valider_xml_api_v1_traitement_valider_xml_post:
      properties:
        fichier_xml:
          description: Fichier XML Factur-X √† valider (format .xml).
          format: binary
          title: Fichier Xml
          type: string
        profil:
          allOf:
          - $ref: "#/components/schemas/ProfilAPI"
          default: EXTENDED
          description: "Profil de validation (MINIMUM, BASIC, EN16931, EXTENDED)."
      required:
      - fichier_xml
      title: Body_valider_xml_api_v1_traitement_valider_xml_post
    Body_verifier_pdf_async_api_v1_verification_verifier_async_post:
      properties:
        fichier_pdf:
          description: Fichier PDF Factur-X √† v√©rifier
          format: binary
          title: Fichier Pdf
          type: string
        forcer_ocr:
          default: false
          description: Forcer l'utilisation de l'OCR m√™me si le PDF contient du texte
            natif
          title: Forcer Ocr
          type: boolean
      required:
      - fichier_pdf
      title: Body_verifier_pdf_async_api_v1_verification_verifier_async_post
    Body_verifier_pdf_sync_api_v1_verification_verifier_post:
      properties:
        fichier_pdf:
          description: Fichier PDF Factur-X √† v√©rifier
          format: binary
          title: Fichier Pdf
          type: string
      required:
      - fichier_pdf
      title: Body_verifier_pdf_sync_api_v1_verification_verifier_post
    BoundingBoxSchema:
      description: |-
        Coordonn√©es d'une zone rectangulaire dans le PDF.

        Les coordonn√©es sont en points PDF (1 point = 1/72 pouce).
        L'origine (0,0) est en bas √† gauche de la page.
      example:
        height: 15.0
        page: 0
        width: 70.3
        x0: 350.5
        x1: 420.8
        y0: 720.0
        y1: 735.0
      properties:
        x0:
          description: Coordonn√©e X gauche
          title: X0
          type: number
        y0:
          description: Coordonn√©e Y bas
          title: Y0
          type: number
        x1:
          description: Coordonn√©e X droite
          title: X1
          type: number
        y1:
          description: Coordonn√©e Y haut
          title: Y1
          type: number
        page:
          default: 0
          description: Num√©ro de page (0-indexed)
          minimum: 0.0
          title: Page
          type: integer
        width:
          description: Largeur de la zone
          title: Width
          type: number
        height:
          description: Hauteur de la zone
          title: Height
          type: number
      required:
      - height
      - width
      - x0
      - x1
      - y0
      - y1
      title: BoundingBoxSchema
    CertificateInfoResponse:
      description: Informations sur un certificat g√©n√©r√©.
      properties:
        cn:
          description: Common Name
          example: Test Signature Client XYZ
          title: Cn
          type: string
        organisation:
          description: Organisation
          example: Client XYZ SARL
          title: Organisation
          type: string
        pays:
          description: Code pays
          example: FR
          title: Pays
          type: string
        ville:
          description: Ville
          example: Lyon
          title: Ville
          type: string
        province:
          description: Province
          example: Rh√¥ne-Alpes
          title: Province
          type: string
        email:
          nullable: true
          type: string
        sujet:
          description: Sujet complet (RFC4514)
          example: "CN=Test Signature Client XYZ,O=Client XYZ SARL,L=Lyon,ST=Rh√¥ne-Alpes,C=FR"
          title: Sujet
          type: string
        emetteur:
          description: √âmetteur (auto-sign√© = m√™me que sujet)
          example: "CN=Test Signature Client XYZ,O=Client XYZ SARL,L=Lyon,ST=Rh√¥ne-Alpes,C=FR"
          title: Emetteur
          type: string
        numero_serie:
          description: Num√©ro de s√©rie du certificat
          example: 123456789
          title: Numero Serie
          type: integer
        valide_du:
          description: Date de d√©but de validit√© (ISO 8601)
          example: 2025-01-07T12:00:00+00:00
          title: Valide Du
          type: string
        valide_au:
          description: Date de fin de validit√© (ISO 8601)
          example: 2026-01-07T12:00:00+00:00
          title: Valide Au
          type: string
        algorithme:
          description: Algorithme de signature
          example: sha256WithRSAEncryption
          title: Algorithme
          type: string
      required:
      - algorithme
      - cn
      - emetteur
      - numero_serie
      - organisation
      - pays
      - province
      - sujet
      - valide_au
      - valide_du
      - ville
      title: CertificateInfoResponse
    ChampVerifieSchema:
      description: Un champ v√©rifi√© avec toutes ses informations (extraction + conformit√©
        + localisation).
      example:
        bbox:
          height: 15.0
          page: 0
          width: 70.3
          x0: 350.5
          x1: 420.8
          y0: 720.0
          y1: 735.0
        business_term: BT-1
        confiance: 0.95
        label: N¬∞ Facture
        message: Conforme
        source: pdf_natif
        statut: CONFORME
        valeur_pdf: FACT-2024-001
        valeur_xml: FACT-2024-001
      properties:
        business_term:
          description: "Business Term EN16931 (ex: BT-1)"
          title: Business Term
          type: string
        label:
          description: "Libell√© du champ (ex: N¬∞ Facture)"
          title: Label
          type: string
        valeur_pdf:
          nullable: true
          type: string
        valeur_xml:
          nullable: true
          type: string
        statut:
          allOf:
          - $ref: "#/components/schemas/StatutChampAPI"
          description: Statut de conformit√©
        message:
          nullable: true
          type: string
        confiance:
          default: 1.0
          description: Score de confiance (0-1)
          maximum: 1.0
          minimum: 0.0
          title: Confiance
          type: number
        source:
          default: pdf_natif
          description: Source d'extraction
          title: Source
          type: string
        bbox:
          allOf:
          - $ref: "#/components/schemas/BoundingBoxSchema"
          nullable: true
      required:
      - business_term
      - label
      - statut
      title: ChampVerifieSchema
    ChorusProCredentials:
      description: |-
        Credentials Chorus Pro pour mode Zero-Trust.

        **Mode Zero-Trust** : Les credentials sont pass√©s dans chaque requ√™te et ne sont JAMAIS stock√©s.

        **S√©curit√©** :
        - Les credentials ne sont jamais persist√©s dans la base de donn√©es
        - Ils sont utilis√©s uniquement pour la dur√©e de la requ√™te
        - Transmission s√©curis√©e via HTTPS

        **Cas d'usage** :
        - Environnements √† haute s√©curit√© (banques, administrations)
        - Conformit√© RGPD stricte
        - Tests avec credentials temporaires
        - Utilisateurs ne voulant pas stocker leurs credentials
      example:
        chorus_pro_login: mon_login@entreprise.fr
        chorus_pro_password: MonMotDePasse123!
        piste_client_id: mon_client_id
        piste_client_secret: mon_secret
        sandbox: true
      properties:
        piste_client_id:
          description: Client ID PISTE (portail API gouvernement)
          title: Piste Client Id
          type: string
        piste_client_secret:
          description: Client Secret PISTE
          title: Piste Client Secret
          type: string
        chorus_pro_login:
          description: Login Chorus Pro
          title: Chorus Pro Login
          type: string
        chorus_pro_password:
          description: Mot de passe Chorus Pro
          title: Chorus Pro Password
          type: string
        sandbox:
          default: true
          description: Utiliser l'environnement sandbox (true) ou production (false)
          title: Sandbox
          type: boolean
      required:
      - chorus_pro_login
      - chorus_pro_password
      - piste_client_id
      - piste_client_secret
      title: ChorusProCredentials
    ConsulterFactureRequest:
      description: Consulter une facture.
      example:
        identifiant_facture_cpp: 0
        credentials: ""
      properties:
        credentials:
          allOf:
          - $ref: "#/components/schemas/ChorusProCredentials"
          nullable: true
        identifiant_facture_cpp:
          description: ID Chorus Pro de la facture
          title: Identifiant Facture Cpp
          type: integer
      required:
      - identifiant_facture_cpp
      title: ConsulterFactureRequest
    ConsulterFactureResponse:
      description: D√©tails d'une facture.
      example:
        identifiant_facture_cpp: 6
        id_structure_cpp_destinataire: 1
        code_retour: 0
        date_facture: date_facture
        montant_ttc_total: montant_ttc_total
        libelle: libelle
        designation_structure_destinataire: designation_structure_destinataire
        numero_facture: numero_facture
        statut_courant: ""
      properties:
        code_retour:
          title: Code Retour
          type: integer
        libelle:
          title: Libelle
          type: string
        identifiant_facture_cpp:
          nullable: true
          type: integer
        numero_facture:
          nullable: true
          type: string
        date_facture:
          nullable: true
          type: string
        montant_ttc_total:
          nullable: true
          type: string
        statut_courant:
          allOf:
          - $ref: "#/components/schemas/StatutFacture"
          nullable: true
        id_structure_cpp_destinataire:
          nullable: true
          type: integer
        designation_structure_destinataire:
          nullable: true
          type: string
      required:
      - code_retour
      - libelle
      title: ConsulterFactureResponse
    ConsulterStructureRequest:
      description: Consulter les d√©tails d'une structure.
      example:
        code_langue: fr
        id_structure_cpp: 0
        credentials: ""
      properties:
        credentials:
          allOf:
          - $ref: "#/components/schemas/ChorusProCredentials"
          nullable: true
        id_structure_cpp:
          description: ID Chorus Pro de la structure
          title: Id Structure Cpp
          type: integer
        code_langue:
          default: fr
          description: "Code langue (fr, en)"
          title: Code Langue
          type: string
      required:
      - id_structure_cpp
      title: ConsulterStructureRequest
    ConsulterStructureResponse:
      description: D√©tails d'une structure.
      example:
        numero_tva: numero_tva
        parametres: ""
        code_retour: 0
        id_structure_cpp: 6
        raison_sociale_structure: raison_sociale_structure
        libelle: libelle
        libelle_structure: libelle_structure
        identifiant_structure: identifiant_structure
        email_structure: email_structure
      properties:
        code_retour:
          title: Code Retour
          type: integer
        libelle:
          title: Libelle
          type: string
        id_structure_cpp:
          nullable: true
          type: integer
        identifiant_structure:
          nullable: true
          type: string
        libelle_structure:
          nullable: true
          type: string
        raison_sociale_structure:
          nullable: true
          type: string
        numero_tva:
          nullable: true
          type: string
        email_structure:
          nullable: true
          type: string
        parametres:
          allOf:
          - $ref: "#/components/schemas/ParametresStructure"
          nullable: true
      required:
      - code_retour
      - libelle
      title: ConsulterStructureResponse
    CredentialsAFNOR:
      description: |-
        Credentials AFNOR PDP optionnels.

        **MODE 1 - R√©cup√©ration via JWT (recommand√©) :**
        Ne pas fournir ce champ `credentials` dans le payload.
        Les credentials PDP seront r√©cup√©r√©es automatiquement via client_uid du JWT (0-trust).

        **MODE 2 - Credentials dans le payload (zero-storage) :**
        Fournir tous les champs requis ci-dessous.
        Utile pour tests ou int√©grations tierces.
      example:
        client_id: mon_client_id_pdp
        client_secret: mon_secret_pdp
        flow_service_url: https://api-pdp.example.com/flow/v1
      properties:
        client_id:
          nullable: true
          type: string
        client_secret:
          nullable: true
          type: string
        flow_service_url:
          nullable: true
          type: string
      title: CredentialsAFNOR
    CredentialsChorusPro:
      description: |-
        Credentials Chorus Pro optionnels.

        **MODE 1 - R√©cup√©ration via JWT (recommand√©) :**
        Ne pas fournir ce champ `credentials` dans le payload.
        Les credentials seront r√©cup√©r√©s automatiquement via client_uid du JWT (0-trust).

        **MODE 2 - Credentials dans le payload :**
        Fournir tous les champs requis ci-dessous.
        Utile pour tests ou int√©grations tierces.
      example:
        chorus_login: mon_login@entreprise.fr
        chorus_password: MonMotDePasse123!
        mode_sandbox: true
        piste_client_id: mon_client_id_piste
        piste_client_secret: mon_secret_piste
      properties:
        piste_client_id:
          nullable: true
          type: string
        piste_client_secret:
          nullable: true
          type: string
        chorus_login:
          nullable: true
          type: string
        chorus_password:
          nullable: true
          type: string
        mode_sandbox:
          default: true
          description: "[MODE 2] Utiliser le mode sandbox (d√©faut: True)"
          title: Mode Sandbox
          type: boolean
      title: CredentialsChorusPro
    DestinationAFNOR:
      description: Configuration sp√©cifique pour la destination AFNOR PDP.
      properties:
        type:
          default: afnor
          enum:
          - afnor
          title: Type
          type: string
        credentials:
          allOf:
          - $ref: "#/components/schemas/CredentialsAFNOR"
          nullable: true
        flow_syntax:
          default: Factur-X
          description: Syntaxe du flux √† envoyer
          enum:
          - Factur-X
          - CII
          - UBL
          title: Flow Syntax
          type: string
        tracking_id:
          nullable: true
          type: string
      title: DestinationAFNOR
    DestinationChorusPro:
      description: Configuration sp√©cifique pour la destination Chorus Pro.
      properties:
        type:
          default: chorus_pro
          enum:
          - chorus_pro
          title: Type
          type: string
        credentials:
          allOf:
          - $ref: "#/components/schemas/CredentialsChorusPro"
          nullable: true
      title: DestinationChorusPro
    DimensionPageSchema:
      description: Dimensions d'une page PDF.
      example:
        height: 841.8
        width: 595.2
      properties:
        width:
          description: Largeur en points PDF
          title: Width
          type: number
        height:
          description: Hauteur en points PDF
          title: Height
          type: number
      required:
      - height
      - width
      title: DimensionPageSchema
    DonneesFactureSimplifiees:
      description: Donn√©es simplifi√©es de la facture (format minimal pour auto-enrichissement).
      properties:
        numero:
          description: Num√©ro de facture unique
          title: Numero
          type: string
        emetteur:
          additionalProperties: true
          description: "Informations sur l'√©metteur (siret, iban, ...)"
          title: Emetteur
          type: object
        destinataire:
          additionalProperties: true
          description: "Informations sur le destinataire (siret, ...)"
          title: Destinataire
          type: object
        lignes:
          description: Lignes de la facture
          items:
            additionalProperties: true
            type: object
          minItems: 1
          type: array
        date:
          nullable: true
          type: string
        echeance_jours:
          default: 30
          description: "√âch√©ance en jours (d√©faut: 30)"
          maximum: 365.0
          minimum: 0.0
          title: Echeance Jours
          type: integer
        commentaire:
          nullable: true
          type: string
        numero_bon_commande:
          nullable: true
          type: string
        numero_marche:
          nullable: true
          type: string
      required:
      - destinataire
      - emetteur
      - lignes
      - numero
      title: DonneesFactureSimplifiees
    ErrorLevel:
      enum:
      - Error
      - Warning
      type: string
    ErrorSource:
      enum:
      - schematron
      - pdfa
      - pydantic
      - xmp
      - signature
      - afnor
      - chorus_pro
      - system
      type: string
    FactureEnrichieInfo:
      description: Informations sur la facture enrichie.
      properties:
        numero_facture:
          title: Numero Facture
          type: string
        id_emetteur:
          nullable: true
          type: integer
        id_destinataire:
          nullable: true
          type: integer
        nom_emetteur:
          title: Nom Emetteur
          type: string
        nom_destinataire:
          title: Nom Destinataire
          type: string
        montant_ht_total:
          pattern: "^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"
          title: Montant Ht Total
          type: string
        montant_tva:
          pattern: "^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"
          title: Montant Tva
          type: string
        montant_ttc_total:
          pattern: "^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"
          title: Montant Ttc Total
          type: string
      required:
      - montant_ht_total
      - montant_ttc_total
      - montant_tva
      - nom_destinataire
      - nom_emetteur
      - numero_facture
      title: FactureEnrichieInfo
    FactureEntrante:
      description: |-
        Facture re√ßue d'un fournisseur via PDP/PA.

        Ce mod√®le contient les m√©tadonn√©es essentielles extraites des factures
        entrantes, quel que soit leur format source (CII, UBL, Factur-X).

        Les montants sont en Decimal en Python mais seront s√©rialis√©s en
        string dans le JSON pour pr√©server la pr√©cision mon√©taire.
      example:
        reference_contrat: reference_contrat
        date_de_piece: date_de_piece
        montant_ht: montant_ht
        fournisseur: ""
        ref_fournisseur: ref_fournisseur
        montant_ttc: montant_ttc
        format_source: ""
        devise: EUR
        numero_bon_commande: numero_bon_commande
        document_base64: document_base64
        document_content_type: document_content_type
        flow_id: flow_id
        montant_tva: montant_tva
        site_facturation_nom: site_facturation_nom
        date_reglement: date_reglement
        objet_facture: objet_facture
        site_facturation_siret: site_facturation_siret
        document_filename: document_filename
        type_document: ""
      properties:
        flow_id:
          nullable: true
          type: string
        format_source:
          allOf:
          - $ref: "#/components/schemas/FormatFacture"
          description: Format source de la facture
        ref_fournisseur:
          description: Num√©ro de facture √©mis par le fournisseur (BT-1)
          title: Ref Fournisseur
          type: string
        type_document:
          allOf:
          - $ref: "#/components/schemas/TypeDocument"
          default: "380"
          description: Type de document (BT-3)
        fournisseur:
          allOf:
          - $ref: "#/components/schemas/FournisseurEntrant"
          description: √âmetteur de la facture (SellerTradeParty)
        site_facturation_nom:
          description: Nom du destinataire / votre entreprise (BT-44)
          title: Site Facturation Nom
          type: string
        site_facturation_siret:
          nullable: true
          type: string
        date_de_piece:
          description: Date de la facture (BT-2) - YYYY-MM-DD
          title: Date De Piece
          type: string
        date_reglement:
          nullable: true
          type: string
        devise:
          default: EUR
          description: Code devise ISO (BT-5)
          title: Devise
          type: string
        montant_ht:
          description: Montant HT total (BT-109)
          pattern: "^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"
          title: Montant Ht
          type: string
        montant_tva:
          description: Montant TVA total (BT-110)
          pattern: "^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"
          title: Montant Tva
          type: string
        montant_ttc:
          description: Montant TTC total (BT-112)
          pattern: "^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"
          title: Montant Ttc
          type: string
        numero_bon_commande:
          nullable: true
          type: string
        reference_contrat:
          nullable: true
          type: string
        objet_facture:
          nullable: true
          type: string
        document_base64:
          nullable: true
          type: string
        document_content_type:
          nullable: true
          type: string
        document_filename:
          nullable: true
          type: string
      required:
      - date_de_piece
      - format_source
      - fournisseur
      - montant_ht
      - montant_ttc
      - montant_tva
      - ref_fournisseur
      - site_facturation_nom
      title: FactureEntrante
    FormatFacture:
      description: Formats de facture support√©s pour l'extraction.
      enum:
      - CII
      - UBL
      - Factur-X
      title: FormatFacture
      type: string
    FormatSortie:
      enum:
      - xml
      - pdf
      title: FormatSortie
      type: string
    FournisseurEntrant:
      description: |-
        Fournisseur extrait d'une facture entrante.

        Contrairement au mod√®le Fournisseur de models.py, ce mod√®le n'a pas
        de champ id_fournisseur car cette information n'est pas disponible
        dans les XML Factur-X/CII/UBL.
      properties:
        nom:
          description: Raison sociale du fournisseur (BT-27)
          title: Nom
          type: string
        siren:
          nullable: true
          type: string
        siret:
          nullable: true
          type: string
        numero_tva_intra:
          nullable: true
          type: string
        adresse_postale:
          allOf:
          - $ref: "#/components/schemas/AdressePostale"
          nullable: true
        adresse_electronique:
          allOf:
          - $ref: "#/components/schemas/AdresseElectronique"
          nullable: true
        email:
          nullable: true
          type: string
        telephone:
          nullable: true
          type: string
      required:
      - nom
      title: FournisseurEntrant
    GenerateCertificateRequest:
      description: |-
        Requ√™te pour g√©n√©rer un certificat X.509 auto-sign√© de test.

        ‚ö†Ô∏è ATTENTION : Ce certificat est destin√© uniquement aux TESTS.
        NE PAS utiliser en production !
        Niveau eIDAS : SES (Simple Electronic Signature)
      example:
        cn: Test Signature Client XYZ
        duree_jours: 365
        email: contact@xyz.fr
        generer_p12: false
        organisation: Client XYZ SARL
        passphrase_p12: changeme
        pays: FR
        province: Rh√¥ne-Alpes
        taille_cle: 2048
        ville: Lyon
      properties:
        cn:
          default: Test Signature FactPulse
          description: Common Name (CN) - Nom du certificat
          example: Test Signature Client XYZ
          title: Cn
          type: string
        organisation:
          default: FactPulse Test
          description: Organisation (O)
          example: Client XYZ SARL
          title: Organisation
          type: string
        pays:
          default: FR
          description: Code pays ISO 2 lettres (C)
          example: FR
          maxLength: 2
          minLength: 2
          title: Pays
          type: string
        ville:
          default: Paris
          description: Ville (L)
          example: Paris
          title: Ville
          type: string
        province:
          default: Ile-de-France
          description: Province/√âtat (ST)
          example: Ile-de-France
          title: Province
          type: string
        email:
          nullable: true
          type: string
        duree_jours:
          default: 365
          description: Dur√©e de validit√© en jours
          example: 365
          maximum: 3650.0
          minimum: 1.0
          title: Duree Jours
          type: integer
        taille_cle:
          default: 2048
          description: Taille de la cl√© RSA en bits
          example: 2048
          title: Taille Cle
          type: integer
        passphrase_cle:
          nullable: true
          type: string
        generer_p12:
          default: false
          description: G√©n√©rer aussi un fichier PKCS#12 (.p12)
          example: false
          title: Generer P12
          type: boolean
        passphrase_p12:
          default: changeme
          description: Passphrase pour le fichier PKCS#12
          example: changeme
          title: Passphrase P12
          type: string
      title: GenerateCertificateRequest
    GenerateCertificateResponse:
      description: |-
        R√©ponse apr√®s g√©n√©ration d'un certificat de test.

        Contient le certificat PEM, la cl√© priv√©e PEM, et optionnellement le PKCS#12.
      example:
        avertissement: "‚ö†Ô∏è Ce certificat est AUTO-SIGN√â et destin√© uniquement aux\
          \ TESTS. Ne PAS utiliser en production. Niveau eIDAS : SES (Simple Electronic\
          \ Signature)"
        certificat_pem: |-
          -----BEGIN CERTIFICATE-----
          MIID...
          -----END CERTIFICATE-----
        cle_privee_pem: |-
          -----BEGIN PRIVATE KEY-----
          MIIE...
          -----END PRIVATE KEY-----
        info:
          algorithme: sha256WithRSAEncryption
          cn: Test Signature Client XYZ
          email: contact@xyz.fr
          emetteur: "CN=Test Signature Client XYZ,O=Client XYZ SARL,L=Lyon,ST=Rh√¥\
            ne-Alpes,C=FR"
          numero_serie: 123456789
          organisation: Client XYZ SARL
          pays: FR
          province: Rh√¥ne-Alpes
          sujet: "CN=Test Signature Client XYZ,O=Client XYZ SARL,L=Lyon,ST=Rh√¥ne-Alpes,C=FR"
          valide_au: 2026-01-07T12:00:00+00:00
          valide_du: 2025-01-07T12:00:00+00:00
          ville: Lyon
        status: success
      properties:
        status:
          default: success
          description: Statut de l'op√©ration
          example: success
          title: Status
          type: string
        certificat_pem:
          description: Certificat X.509 au format PEM
          example: |-
            -----BEGIN CERTIFICATE-----
            MIID...
            -----END CERTIFICATE-----
          title: Certificat Pem
          type: string
        cle_privee_pem:
          description: Cl√© priv√©e RSA au format PEM
          example: |-
            -----BEGIN PRIVATE KEY-----
            MIIE...
            -----END PRIVATE KEY-----
          title: Cle Privee Pem
          type: string
        pkcs12_base64:
          nullable: true
          type: string
        info:
          allOf:
          - $ref: "#/components/schemas/CertificateInfoResponse"
          description: Informations sur le certificat g√©n√©r√©
        avertissement:
          default: "‚ö†Ô∏è Ce certificat est AUTO-SIGN√â et destin√© uniquement aux TESTS.\
            \ Ne PAS utiliser en production. Niveau eIDAS : SES (Simple Electronic\
            \ Signature)"
          description: Avertissement sur l'utilisation du certificat
          title: Avertissement
          type: string
      required:
      - certificat_pem
      - cle_privee_pem
      - info
      title: GenerateCertificateResponse
    HTTPValidationError:
      example:
        detail:
        - msg: msg
          loc:
          - ValidationError_loc_inner
          - ValidationError_loc_inner
          type: type
        - msg: msg
          loc:
          - ValidationError_loc_inner
          - ValidationError_loc_inner
          type: type
      properties:
        detail:
          items:
            $ref: "#/components/schemas/ValidationError"
          type: array
      title: HTTPValidationError
    InformationSignatureAPI:
      description: Informations sur une signature √©lectronique dans un PDF.
      example:
        signataire: signataire
        date_signature: date_signature
        localisation: localisation
        est_valide: true
        raison: raison
        nom_champ: nom_champ
      properties:
        nom_champ:
          description: Nom du champ de signature dans le PDF
          title: Nom Champ
          type: string
        signataire:
          nullable: true
          type: string
        date_signature:
          nullable: true
          type: string
        raison:
          nullable: true
          type: string
        localisation:
          nullable: true
          type: string
        est_valide:
          nullable: true
          type: boolean
      required:
      - nom_champ
      title: InformationSignatureAPI
    NoteObligatoireSchema:
      description: Note obligatoire d√©tect√©e avec localisation et comparaison XML/PDF.
      example:
        bbox:
          height: 5.8
          page: 0
          width: 61.6
          x0: 238.4
          x1: 300.0
          y0: 164.4
          y1: 170.2
        code_sujet: PMT
        label: Indemnit√© recouvrement
        message: Texte XML trouv√© dans le PDF
        statut: CONFORME
        valeur_pdf: indemnit√© forfaitaire de 40 euros
        valeur_xml: "En cas de retard de paiement, une indemnit√© forfaitaire de 40\
          \ euros sera due."
      properties:
        code_sujet:
          description: "Code sujet (PMT, PMD, AAB)"
          title: Code Sujet
          type: string
        label:
          description: "Libell√© (ex: Indemnit√© recouvrement)"
          title: Label
          type: string
        valeur_pdf:
          nullable: true
          type: string
        valeur_xml:
          nullable: true
          type: string
        statut:
          allOf:
          - $ref: "#/components/schemas/StatutChampAPI"
          default: NON_VERIFIE
          description: Statut de conformit√© (CONFORME si XML trouv√© dans PDF)
        message:
          nullable: true
          type: string
        bbox:
          allOf:
          - $ref: "#/components/schemas/BoundingBoxSchema"
          nullable: true
      required:
      - code_sujet
      - label
      title: NoteObligatoireSchema
    ObtenirIdChorusProRequest:
      description: Obtenir l'ID Chorus Pro depuis un SIRET.
      example:
        credentials: ""
        type_identifiant: SIRET
        siret: siret
      properties:
        credentials:
          allOf:
          - $ref: "#/components/schemas/ChorusProCredentials"
          nullable: true
        siret:
          description: SIRET de la structure (14 chiffres)
          title: Siret
          type: string
        type_identifiant:
          default: SIRET
          description: "Type d'identifiant (SIRET, SIREN, UE_HORS_FRANCE, etc.)"
          title: Type Identifiant
          type: string
      required:
      - siret
      title: ObtenirIdChorusProRequest
    ObtenirIdChorusProResponse:
      description: ID Chorus Pro trouv√©.
      example:
        designation_structure: designation_structure
        id_structure_cpp: 0
        identifiant_structure: identifiant_structure
        message: message
      properties:
        id_structure_cpp:
          description: ID Chorus Pro (0 si non trouv√©)
          title: Id Structure Cpp
          type: integer
        identifiant_structure:
          description: SIRET/SIREN recherch√©
          title: Identifiant Structure
          type: string
        designation_structure:
          nullable: true
          type: string
        message:
          description: Message de retour
          title: Message
          type: string
      required:
      - id_structure_cpp
      - identifiant_structure
      - message
      title: ObtenirIdChorusProResponse
    OptionsProcessing:
      description: Options de traitement pour la g√©n√©ration et la soumission.
      example:
        auto_enrichir: true
        profil_facturx: EN16931
        valider: true
        verifier_parametres_destination: true
      properties:
        profil_facturx:
          allOf:
          - $ref: "#/components/schemas/ProfilAPI"
          default: EN16931
          description: Profil Factur-X √† utiliser
        auto_enrichir:
          default: true
          description: "Auto-enrichir les donn√©es (APIs Entreprises, Chorus Pro, etc.)"
          title: Auto Enrichir
          type: boolean
        valider:
          default: true
          description: Valider le XML Factur-X avec Schematron
          title: Valider
          type: boolean
        verifier_parametres_destination:
          default: true
          description: "V√©rifier les param√®tres requis par la destination (ex: code_service\
            \ pour Chorus)"
          title: Verifier Parametres Destination
          type: boolean
      title: OptionsProcessing
    PDFFacturXInfo:
      description: Informations sur le PDF Factur-X g√©n√©r√©.
      properties:
        taille:
          description: Taille du PDF en octets
          title: Taille
          type: integer
        profil:
          description: Profil Factur-X utilis√©
          title: Profil
          type: string
        signe:
          default: false
          description: PDF sign√© √©lectroniquement
          title: Signe
          type: boolean
      required:
      - profil
      - taille
      title: PDFFacturXInfo
    ParametresSignature:
      description: |-
        Param√®tres optionnels pour signer le PDF g√©n√©r√©.

        **MODE 1 - Certificat stock√© (recommand√©) :**
        Ne fournissez que les m√©tadonn√©es (raison, localisation, etc.).
        Le certificat sera r√©cup√©r√© automatiquement via client_uid du JWT.
        Signature PAdES-B-LT conforme eIDAS.

        **MODE 2 - Cl√©s dans le payload (tests/cas sp√©ciaux) :**
        Fournissez key_pem + cert_pem directement dans le payload.
        Format PEM accept√© : brut ("-----BEGIN...") ou base64.

        **R√®gle de s√©lection :**
        - Si key_pem ET cert_pem fournis ‚Üí Mode 2 (cl√©s payload)
        - Sinon ‚Üí Mode 1 (certificat stock√© r√©cup√©r√© via client_uid)
      properties:
        key_pem:
          nullable: true
          type: string
        cert_pem:
          nullable: true
          type: string
        key_passphrase:
          nullable: true
          type: string
        raison:
          nullable: true
          type: string
        localisation:
          nullable: true
          type: string
        contact:
          nullable: true
          type: string
        field_name:
          default: FactPulseSignature
          description: Nom du champ de signature PDF
          title: Field Name
          type: string
        use_pades_lt:
          default: false
          description: Activer PAdES-B-LT (archivage long terme). N√âCESSITE certificat
            avec acc√®s OCSP/CRL
          title: Use Pades Lt
          type: boolean
        use_timestamp:
          default: true
          description: Activer l'horodatage RFC 3161 avec FreeTSA (PAdES-B-T)
          title: Use Timestamp
          type: boolean
      title: ParametresSignature
    ParametresStructure:
      description: Param√®tres obligatoires d'une structure.
      properties:
        code_service_doit_etre_renseigne:
          default: false
          description: Le code service est obligatoire
          title: Code Service Doit Etre Renseigne
          type: boolean
        numero_ej_doit_etre_renseigne:
          default: false
          description: Le num√©ro d'engagement est obligatoire
          title: Numero Ej Doit Etre Renseigne
          type: boolean
        gestion_numero_ej_ou_code_service:
          default: false
          description: Gestion EJ ou code service activ√©e
          title: Gestion Numero Ej Ou Code Service
          type: boolean
      title: ParametresStructure
    ProfilAPI:
      enum:
      - MINIMUM
      - BASIC
      - EN16931
      - EXTENDED
      title: ProfilAPI
      type: string
    RechercherServicesResponse:
      description: Liste des services d'une structure.
      example:
        total: 1
        code_retour: 0
        liste_services:
        - libelle_service: libelle_service
          code_service: code_service
          est_actif: true
          id_service: 6
        - libelle_service: libelle_service
          code_service: code_service
          est_actif: true
          id_service: 6
        libelle: libelle
      properties:
        code_retour:
          title: Code Retour
          type: integer
        libelle:
          title: Libelle
          type: string
        liste_services:
          items:
            $ref: "#/components/schemas/ServiceStructure"
          type: array
        total:
          default: 0
          description: Nombre de services
          title: Total
          type: integer
      required:
      - code_retour
      - libelle
      title: RechercherServicesResponse
    RechercherStructureRequest:
      description: Recherche de structures par crit√®res.
      example:
        raison_sociale_structure: raison_sociale_structure
        credentials: ""
        identifiant_structure: identifiant_structure
        restreindre_structures_privees: false
        type_identifiant_structure: type_identifiant_structure
      properties:
        credentials:
          allOf:
          - $ref: "#/components/schemas/ChorusProCredentials"
          nullable: true
        identifiant_structure:
          nullable: true
          type: string
        type_identifiant_structure:
          nullable: true
          type: string
        raison_sociale_structure:
          nullable: true
          type: string
        restreindre_structures_privees:
          default: false
          description: Limiter la recherche aux structures priv√©es uniquement
          title: Restreindre Structures Privees
          type: boolean
      title: RechercherStructureRequest
    RechercherStructureResponse:
      description: R√©ponse de recherche de structures.
      example:
        total: 1
        code_retour: 0
        libelle: libelle
        liste_structures:
        - designation_structure: designation_structure
          id_structure_cpp: 6
          identifiant_structure: identifiant_structure
          type_identifiant_structure: type_identifiant_structure
          statut: statut
        - designation_structure: designation_structure
          id_structure_cpp: 6
          identifiant_structure: identifiant_structure
          type_identifiant_structure: type_identifiant_structure
          statut: statut
      properties:
        code_retour:
          description: Code retour (0 = succ√®s)
          title: Code Retour
          type: integer
        libelle:
          description: Message de retour
          title: Libelle
          type: string
        liste_structures:
          items:
            $ref: "#/components/schemas/StructureInfo"
          type: array
        total:
          default: 0
          description: Nombre total de r√©sultats
          title: Total
          type: integer
      required:
      - code_retour
      - libelle
      title: RechercherStructureResponse
    ReponseTache:
      description: R√©ponse imm√©diate apr√®s la soumission d'une t√¢che asynchrone.
      example:
        id_tache: id_tache
      properties:
        id_tache:
          title: Id Tache
          type: string
      required:
      - id_tache
      title: ReponseTache
    ReponseValidationErreur:
      example:
        detail:
        - detail
        - detail
      properties:
        detail:
          description: Liste des erreurs de validation d√©tect√©es.
          items:
            type: string
          type: array
      required:
      - detail
      title: ReponseValidationErreur
    ReponseValidationSucces:
      example:
        message: message
      properties:
        message:
          description: Message confirmant la conformit√© du XML.
          title: Message
          type: string
      required:
      - message
      title: ReponseValidationSucces
    ReponseVerificationSucces:
      description: R√©ponse de v√©rification r√©ussie avec donn√©es unifi√©es.
      example:
        avertissements: []
        champs:
        - bbox:
            height: 15.0
            page: 0
            width: 70.3
            x0: 350.5
            x1: 420.8
            y0: 720.0
            y1: 735.0
          business_term: BT-1
          confiance: 0.95
          label: N¬∞ Facture
          message: Conforme
          source: pdf_natif
          statut: CONFORME
          valeur_pdf: FACT-2024-001
          valeur_xml: FACT-2024-001
        - bbox:
            height: 15.0
            page: 0
            width: 70.0
            x0: 450.0
            x1: 520.0
            y0: 300.0
            y1: 315.0
          business_term: BT-109
          confiance: 0.9
          label: Total HT
          message: Conforme
          source: pdf_natif
          statut: CONFORME
          valeur_pdf: "1000.00"
          valeur_xml: "1000.00"
        champs_conformes: 12
        champs_verifies: 12
        dimensions_pages:
        - height: 841.8
          width: 595.2
        est_conforme: true
        est_facturx: true
        notes_obligatoires:
        - bbox:
            height: 15.0
            page: 0
            width: 80.0
            x0: 100.0
            x1: 180.0
            y0: 150.0
            y1: 165.0
          code_sujet: PMT
          contenu: 40 ‚Ç¨
          label: Indemnit√© recouvrement
          presente: true
        profil_facturx: EN16931
        score_conformite: 100.0
      properties:
        est_conforme:
          description: True si aucun √©cart critique
          title: Est Conforme
          type: boolean
        score_conformite:
          description: Score de conformit√© (0-100%)
          maximum: 100.0
          minimum: 0.0
          title: Score Conformite
          type: number
        champs_verifies:
          default: 0
          description: Nombre de champs v√©rifi√©s
          minimum: 0.0
          title: Champs Verifies
          type: integer
        champs_conformes:
          default: 0
          description: Nombre de champs conformes
          minimum: 0.0
          title: Champs Conformes
          type: integer
        est_facturx:
          default: false
          description: True si le PDF contient du XML Factur-X
          title: Est Facturx
          type: boolean
        profil_facturx:
          nullable: true
          type: string
        champs:
          description: "Liste des champs v√©rifi√©s avec valeurs, statuts et coordonn√©\
            es PDF"
          items:
            $ref: "#/components/schemas/ChampVerifieSchema"
          type: array
        notes_obligatoires:
          description: "Notes obligatoires (PMT, PMD, AAB) avec localisation PDF"
          items:
            $ref: "#/components/schemas/NoteObligatoireSchema"
          type: array
        dimensions_pages:
          description: "Dimensions de chaque page du PDF (largeur, hauteur)"
          items:
            $ref: "#/components/schemas/DimensionPageSchema"
          type: array
        avertissements:
          description: Avertissements non bloquants
          items:
            type: string
          type: array
      required:
      - est_conforme
      - score_conformite
      title: ReponseVerificationSucces
    ResultatAFNOR:
      description: R√©sultat de la soumission √† AFNOR PDP.
      properties:
        flow_id:
          description: Identifiant du flux soumis
          title: Flow Id
          type: string
        tracking_id:
          nullable: true
          type: string
        sha256:
          description: Hash SHA-256 du fichier soumis
          title: Sha256
          type: string
        flow_syntax:
          description: Syntaxe du flux
          title: Flow Syntax
          type: string
        flow_profile:
          nullable: true
          type: string
      required:
      - flow_id
      - flow_syntax
      - sha256
      title: ResultatAFNOR
    ResultatChorusPro:
      description: R√©sultat de la soumission √† Chorus Pro.
      properties:
        identifiant_facture_cpp:
          description: ID Chorus Pro de la facture soumise
          title: Identifiant Facture Cpp
          type: integer
        numero_flux_depot:
          nullable: true
          type: string
        piece_jointe_id:
          nullable: true
          type: integer
      required:
      - identifiant_facture_cpp
      title: ResultatChorusPro
    ResultatValidationPDFAPI:
      description: R√©sultat complet de la validation d'un PDF Factur-X.
      example:
        version_xmp: version_xmp
        nombre_signatures: 1
        erreurs_pdfa:
        - erreurs_pdfa
        - erreurs_pdfa
        erreurs_signatures:
        - erreurs_signatures
        - erreurs_signatures
        erreurs_xml:
        - erreurs_xml
        - erreurs_xml
        signatures:
        - signataire: signataire
          date_signature: date_signature
          localisation: localisation
          est_valide: true
          raison: raison
          nom_champ: nom_champ
        - signataire: signataire
          date_signature: date_signature
          localisation: localisation
          est_valide: true
          raison: raison
          nom_champ: nom_champ
        profil_detecte: profil_detecte
        erreurs_xmp:
        - erreurs_xmp
        - erreurs_xmp
        pdfa_conforme: true
        xml_conforme: true
        est_signe: true
        version_pdfa: version_pdfa
        avertissements_pdfa:
        - avertissements_pdfa
        - avertissements_pdfa
        est_conforme: true
        regles_validees: 0
        xmp_present: true
        methode_validation_pdfa: metadata
        regles_echouees: 6
        xmp_conforme_facturx: true
        profil_xmp: profil_xmp
        xml_present: true
        metadonnees_xmp:
          key: ""
        message_resume: message_resume
      properties:
        est_conforme:
          description: "True si le PDF est conforme √† tous les crit√®res (XML, PDF/A,\
            \ XMP)"
          title: Est Conforme
          type: boolean
        xml_present:
          description: True si un XML Factur-X est embarqu√© dans le PDF
          title: Xml Present
          type: boolean
        xml_conforme:
          description: True si le XML Factur-X est conforme aux r√®gles Schematron
          title: Xml Conforme
          type: boolean
        profil_detecte:
          nullable: true
          type: string
        erreurs_xml:
          description: Liste des erreurs de validation XML
          items:
            type: string
          type: array
        pdfa_conforme:
          description: True si le PDF est conforme PDF/A
          title: Pdfa Conforme
          type: boolean
        version_pdfa:
          nullable: true
          type: string
        methode_validation_pdfa:
          default: metadata
          description: M√©thode utilis√©e pour la validation PDF/A (metadata ou verapdf)
          title: Methode Validation Pdfa
          type: string
        regles_validees:
          nullable: true
          type: integer
        regles_echouees:
          nullable: true
          type: integer
        erreurs_pdfa:
          description: Liste des erreurs de conformit√© PDF/A
          items:
            type: string
          type: array
        avertissements_pdfa:
          description: Liste des avertissements PDF/A
          items:
            type: string
          type: array
        xmp_present:
          description: True si des m√©tadonn√©es XMP sont pr√©sentes
          title: Xmp Present
          type: boolean
        xmp_conforme_facturx:
          description: True si les m√©tadonn√©es XMP contiennent des informations Factur-X
          title: Xmp Conforme Facturx
          type: boolean
        profil_xmp:
          nullable: true
          type: string
        version_xmp:
          nullable: true
          type: string
        erreurs_xmp:
          description: Liste des erreurs de m√©tadonn√©es XMP
          items:
            type: string
          type: array
        metadonnees_xmp:
          additionalProperties: true
          description: M√©tadonn√©es XMP extraites du PDF
          title: Metadonnees Xmp
          type: object
        est_signe:
          description: True si le PDF contient au moins une signature
          title: Est Signe
          type: boolean
        nombre_signatures:
          default: 0
          description: Nombre de signatures √©lectroniques trouv√©es
          title: Nombre Signatures
          type: integer
        signatures:
          description: Liste des signatures trouv√©es avec leurs informations
          items:
            $ref: "#/components/schemas/InformationSignatureAPI"
          type: array
        erreurs_signatures:
          description: Liste des erreurs lors de l'analyse des signatures
          items:
            type: string
          type: array
        message_resume:
          description: Message r√©sumant le r√©sultat de la validation
          title: Message Resume
          type: string
      required:
      - est_conforme
      - est_signe
      - message_resume
      - pdfa_conforme
      - xml_conforme
      - xml_present
      - xmp_conforme_facturx
      - xmp_present
      title: ResultatValidationPDFAPI
    SchemeID:
      description: |-
        Codes de sch√©mas d'identification (Electronic Address Scheme - EAS),
        principalement pour l'adressage des factures √©lectroniques.

        **Valeurs possibles :**
        - `0225` : FR_SIREN - SIREN fran√ßais (le plus commun pour la France, remplace l'ancien 0002)
        - `0088` : GLN - Global Location Number
        - `0060` : DUNS - Data Universal Numbering System
        - `9957` : FR_TVA_INTRA - Num√©ro de TVA intracommunautaire fran√ßais
        - `0199` : GLEIF - Global Legal Entity Identifier Foundation
      enum:
      - "0225"
      - "0088"
      - "0060"
      - "9957"
      - "0199"
      title: SchemeID
      type: string
      x-enum-varnames:
      - FR_SIREN
      - GLN
      - DUNS
      - FR_TVA_INTRA
      - GLEIF
      x-enum-descriptions:
      - "FR_SIREN - SIREN fran√ßais (le plus commun pour la France, remplace l'ancien\
        \ 0002)"
      - GLN - Global Location Number (GLN)
      - DUNS - Data Universal Numbering System (DUNS)
      - FR_TVA_INTRA - Num√©ro de TVA intracommunautaire fran√ßais
      - GLEIF - Global Legal Entity Identifier Foundation (GLEIF)
    ServiceStructure:
      description: Service d'une structure.
      example:
        libelle_service: libelle_service
        code_service: code_service
        est_actif: true
        id_service: 6
      properties:
        id_service:
          description: ID du service
          title: Id Service
          type: integer
        code_service:
          description: Code du service
          title: Code Service
          type: string
        libelle_service:
          description: Libell√© du service
          title: Libelle Service
          type: string
        est_actif:
          description: Service actif
          title: Est Actif
          type: boolean
      required:
      - code_service
      - est_actif
      - id_service
      - libelle_service
      title: ServiceStructure
    SignatureInfo:
      description: Informations sur la signature √©lectronique.
      properties:
        signe:
          description: Le PDF a √©t√© sign√©
          title: Signe
          type: boolean
        cn:
          nullable: true
          type: string
        expiration:
          nullable: true
          type: string
      required:
      - signe
      title: SignatureInfo
    SoumettreFactureCompleteRequest:
      description: |-
        Requ√™te pour soumettre une facture compl√®te (g√©n√©ration + soumission).

        Workflow :
        1. Auto-enrichissement (optionnel)
        2. G√©n√©ration PDF Factur-X
        3. Signature (optionnelle)
        4. Soumission vers la destination
      example:
        destination:
          type: chorus_pro
        donnees_facture:
          destinataire:
            siret: "98765432109876"
          emetteur:
            iban: FR7630006000011234567890189
            siret: "12345678901234"
          lignes:
          - description: Prestation de conseil
            prix_ht: 100.0
            quantite: 10
            tva: 20.0
          numero: FACT-2025-001
        options:
          auto_enrichir: true
          profil_facturx: EN16931
          valider: true
        pdf_source: JVBERi0xLjQKJeLjz9MKMSAwIG9iaiA8PC...
        signature:
          localisation: "Paris, France"
          raison: Conformit√© Factur-X - Signature √©lectronique
          use_pades_lt: false
          use_timestamp: true
      properties:
        donnees_facture:
          allOf:
          - $ref: "#/components/schemas/DonneesFactureSimplifiees"
          description: Donn√©es de la facture au format simplifi√© (voir exemples)
        pdf_source:
          description: PDF source encod√© en base64 (sera transform√© en Factur-X)
          title: Pdf Source
          type: string
        destination:
          $ref: "#/components/schemas/Destination"
        signature:
          allOf:
          - $ref: "#/components/schemas/ParametresSignature"
          nullable: true
        options:
          allOf:
          - $ref: "#/components/schemas/OptionsProcessing"
          description: Options de traitement
      required:
      - destination
      - donnees_facture
      - pdf_source
      title: SoumettreFactureCompleteRequest
    SoumettreFactureCompleteResponse:
      description: R√©ponse compl√®te apr√®s soumission automatis√©e.
      example:
        destination_type: chorus_pro
        facture_enrichie:
          id_destinataire: 99986401
          id_emetteur: 26300989
          montant_ht_total: 1000.0
          montant_ttc_total: 1200.0
          montant_tva: 200.0
          nom_destinataire: CLIENT SA
          nom_emetteur: MA SOCIETE SARL
          numero_facture: FACT-2025-001
        message: Facture soumise avec succ√®s √† Chorus Pro
        pdf_base64: JVBERi0xLjcKJeLjz9MKNSAwIG9iago8PC9GaWx0ZXIvRmxhdGVE...
        pdf_facturx:
          profil: EN16931
          signe: true
          taille: 125430
        resultat_chorus:
          identifiant_facture_cpp: 123456
          numero_flux_depot: FLUX-2025-001
          piece_jointe_id: 78910
        signature:
          cn: MA SOCIETE - Cachet Serveur
          expiration: 2026-12-31T23:59:59Z
          signe: true
        succes: true
      properties:
        succes:
          description: La facture a √©t√© soumise avec succ√®s
          title: Succes
          type: boolean
        destination_type:
          description: Type de destination
          enum:
          - chorus_pro
          - afnor
          title: Destination Type
          type: string
        resultat_chorus:
          allOf:
          - $ref: "#/components/schemas/ResultatChorusPro"
          nullable: true
        resultat_afnor:
          allOf:
          - $ref: "#/components/schemas/ResultatAFNOR"
          nullable: true
        facture_enrichie:
          allOf:
          - $ref: "#/components/schemas/FactureEnrichieInfo"
          description: Donn√©es de la facture enrichie
        pdf_facturx:
          allOf:
          - $ref: "#/components/schemas/PDFFacturXInfo"
          description: Informations sur le PDF g√©n√©r√©
        signature:
          allOf:
          - $ref: "#/components/schemas/SignatureInfo"
          nullable: true
        pdf_base64:
          description: PDF Factur-X g√©n√©r√© (et sign√© si demand√©) encod√© en base64
          title: Pdf Base64
          type: string
        message:
          description: Message de retour
          title: Message
          type: string
      required:
      - destination_type
      - facture_enrichie
      - message
      - pdf_base64
      - pdf_facturx
      - succes
      title: SoumettreFactureCompleteResponse
    SoumettreFactureRequest:
      description: Soumission d'une facture Chorus Pro.
      example:
        date_echeance_paiement: date_echeance_paiement
        id_structure_cpp: 0
        credentials: ""
        date_facture: date_facture
        numero_marche: numero_marche
        piece_jointe_principale_designation: piece_jointe_principale_designation
        numero_engagement: numero_engagement
        numero_bon_commande: numero_bon_commande
        piece_jointe_principale_id: 5
        montant_ttc_total: 5.962133916683182
        montant_tva: 1.4658129805029452
        montant_ht_total: 6.027456183070403
        code_service: code_service
        commentaire: commentaire
        numero_facture: numero_facture
      properties:
        credentials:
          allOf:
          - $ref: "#/components/schemas/ChorusProCredentials"
          nullable: true
        numero_facture:
          description: Num√©ro de la facture
          title: Numero Facture
          type: string
        date_facture:
          description: "Date de facture (format ISO: YYYY-MM-DD)"
          title: Date Facture
          type: string
        date_echeance_paiement:
          nullable: true
          type: string
        id_structure_cpp:
          description: ID Chorus Pro de la structure destinataire
          title: Id Structure Cpp
          type: integer
        code_service:
          nullable: true
          type: string
        numero_engagement:
          nullable: true
          type: string
        montant_ht_total:
          $ref: "#/components/schemas/Montant_Ht_Total"
        montant_tva:
          $ref: "#/components/schemas/Montant_Tva"
        montant_ttc_total:
          $ref: "#/components/schemas/Montant_Ttc_Total"
        piece_jointe_principale_id:
          nullable: true
          type: integer
        piece_jointe_principale_designation:
          nullable: true
          type: string
        commentaire:
          nullable: true
          type: string
        numero_bon_commande:
          nullable: true
          type: string
        numero_marche:
          nullable: true
          type: string
      required:
      - date_facture
      - id_structure_cpp
      - montant_ht_total
      - montant_ttc_total
      - montant_tva
      - numero_facture
      title: SoumettreFactureRequest
    SoumettreFactureResponse:
      description: R√©ponse apr√®s soumission de facture.
      example:
        identifiant_facture_cpp: 6
        code_retour: 0
        libelle: libelle
        numero_flux_depot: numero_flux_depot
      properties:
        code_retour:
          description: Code retour (0 = succ√®s)
          title: Code Retour
          type: integer
        libelle:
          description: Message de retour
          title: Libelle
          type: string
        identifiant_facture_cpp:
          nullable: true
          type: integer
        numero_flux_depot:
          nullable: true
          type: string
      required:
      - code_retour
      - libelle
      title: SoumettreFactureResponse
    StatutCelery:
      description: |-
        Statuts possibles d'une t√¢che Celery lors du polling.

        **Valeurs possibles :**
        - `PENDING` : T√¢che en attente de traitement
        - `STARTED` : T√¢che en cours d'ex√©cution
        - `SUCCESS` : T√¢che termin√©e avec succ√®s (v√©rifier `resultat.statut` pour le r√©sultat m√©tier)
        - `FAILURE` : Erreur syst√®me lors de l'ex√©cution (crash, exception non g√©r√©e)
        - `RETRY` : Tentative de r√©-ex√©cution en cours (apr√®s un √©chec temporaire)
      enum:
      - PENDING
      - STARTED
      - SUCCESS
      - FAILURE
      - RETRY
      title: StatutCelery
      type: string
    StatutChampAPI:
      description: Statut de conformit√© d'un champ.
      enum:
      - CONFORME
      - ECART
      - ABSENT_PDF
      - ABSENT_XML
      - NON_VERIFIE
      title: StatutChampAPI
      type: string
    StatutFacture:
      description: Statut d'une facture Chorus Pro.
      properties:
        code:
          description: "Code statut (SOUMISE, VALIDEE, REJETEE, SUSPENDUE, MANDATEE,\
            \ MISE_EN_PAIEMENT, etc.)"
          title: Code
          type: string
        libelle:
          description: Libell√© du statut
          title: Libelle
          type: string
        date:
          nullable: true
          type: string
      required:
      - code
      - libelle
      title: StatutFacture
    StatutTache:
      description: |-
        Description compl√®te du statut d'une t√¢che asynchrone.

        Le champ `statut` indique l'√©tat Celery de la t√¢che.
        Quand `statut="SUCCESS"`, consultez `resultat.statut` pour le r√©sultat m√©tier ("SUCCES" ou "ERREUR").
      example:
        id_tache: id_tache
        resultat:
          key: ""
        statut: ""
      properties:
        id_tache:
          title: Id Tache
          type: string
        statut:
          allOf:
          - $ref: "#/components/schemas/StatutCelery"
          description: "Statut Celery de la t√¢che (PENDING, STARTED, SUCCESS, FAILURE,\
            \ RETRY)"
        resultat:
          additionalProperties: true
          nullable: true
          type: object
      required:
      - id_tache
      - statut
      title: StatutTache
    StructureInfo:
      description: Informations d'une structure.
      example:
        designation_structure: designation_structure
        id_structure_cpp: 6
        identifiant_structure: identifiant_structure
        type_identifiant_structure: type_identifiant_structure
        statut: statut
      properties:
        id_structure_cpp:
          description: ID Chorus Pro de la structure
          title: Id Structure Cpp
          type: integer
        identifiant_structure:
          description: "Identifiant (SIRET, SIREN)"
          title: Identifiant Structure
          type: string
        designation_structure:
          description: Nom de la structure
          title: Designation Structure
          type: string
        type_identifiant_structure:
          description: Type d'identifiant
          title: Type Identifiant Structure
          type: string
        statut:
          description: "Statut (ACTIVE, INACTIVE)"
          title: Statut
          type: string
      required:
      - designation_structure
      - id_structure_cpp
      - identifiant_structure
      - statut
      - type_identifiant_structure
      title: StructureInfo
    TypeDocument:
      description: |-
        Types de documents commerciaux (UNTDID 1001).

        | Code | Nom | Description |
        |------|-----|-------------|
        | 380 | FACTURE | Facture commerciale |
        | 381 | AVOIR | Avoir |
        | 384 | FACTURE_RECTIFICATIVE | Facture rectificative |
        | 386 | ACOMPTE | Facture d'acompte |
        | 389 | AUTOFACTURATION | Facture auto-factur√©e |
      enum:
      - "380"
      - "381"
      - "384"
      - "386"
      - "389"
      title: TypeDocument
      type: string
      x-enum-descriptions:
      - Facture commerciale
      - Avoir
      - Facture rectificative
      - Facture d'acompte
      - Facture auto-factur√©e
      x-enum-varnames:
      - FACTURE
      - AVOIR
      - FACTURE_RECTIFICATIVE
      - ACOMPTE
      - AUTOFACTURATION
    ValidationError:
      example:
        msg: msg
        loc:
        - ValidationError_loc_inner
        - ValidationError_loc_inner
        type: type
      properties:
        loc:
          items:
            $ref: "#/components/schemas/ValidationError_loc_inner"
          type: array
        msg:
          title: Message
          type: string
        type:
          title: Error Type
          type: string
      required:
      - loc
      - msg
      - type
      title: ValidationError
    ValidationErrorDetail:
      description: |-
        D√©tail d'une erreur de validation (align√© sur AFNOR AcknowledgementDetail).

        Format unifi√© pour toutes les erreurs de validation Factur-X,
        compatible avec la norme AFNOR XP Z12-013.
      properties:
        level:
          allOf:
          - $ref: "#/components/schemas/ErrorLevel"
          default: Error
          description: "Niveau de gravit√© : 'Error' ou 'Warning'"
        item:
          description: "Identifiant de l'√©l√©ment concern√© (XPath, champ, r√®gle BR-FR,\
            \ etc.)"
          title: Item
          type: string
        reason:
          description: Description de l'erreur
          title: Reason
          type: string
        source:
          allOf:
          - $ref: "#/components/schemas/ErrorSource"
          nullable: true
        code:
          nullable: true
          type: string
      required:
      - item
      - reason
      title: ValidationErrorDetail
    Beneficiaire:
      description: |-
        Informations sur le b√©n√©ficiaire du paiement (BG-10 / PayeeTradeParty).

        Le b√©n√©ficiaire est la partie qui re√ßoit le paiement. Ce bloc est utilis√©
        uniquement si le b√©n√©ficiaire est diff√©rent du vendeur (fournisseur).

        **Cas d'usage principal** : Affacturage (factoring)
        Quand une facture est affactur√©e, le factor (soci√©t√© d'affacturage) devient
        le b√©n√©ficiaire du paiement √† la place du fournisseur.

        **Business Terms (EN16931)** :
        - BT-59 : Nom du b√©n√©ficiaire (obligatoire)
        - BT-60 : Identifiant du b√©n√©ficiaire (SIRET avec schemeID 0009)
        - BT-61 : Identifiant l√©gal du b√©n√©ficiaire (SIREN avec schemeID 0002)

        **R√©f√©rence** : docs/guide_affacturage.md
      properties:
        nom:
          description: Nom du b√©n√©ficiaire (BT-59). Obligatoire.
          minLength: 1
          title: Nom
          type: string
        siret:
          nullable: true
          pattern: "^\\d{14}$"
          type: string
        siren:
          nullable: true
          pattern: "^\\d{9}$"
          type: string
        adresseElectronique:
          allOf:
          - $ref: "#/components/schemas/AdresseElectronique"
          nullable: true
        iban:
          nullable: true
          type: string
        bic:
          nullable: true
          type: string
      required:
      - nom
      title: Beneficiaire
    CadreDeFacturation:
      description: |-
        D√©finit le cadre de facturation.

        - code_cadre_facturation: Code Chorus Pro (A1, A2, A9, A12) - utilis√© pour B2G
        - nature_operation: Nature de l'op√©ration (B1, S1, M1, etc.) - prioritaire pour Factur-X

        Si nature_operation est fourni, il sera utilis√© directement dans le XML Factur-X (BT-23).
        Sinon, le code sera d√©duit de code_cadre_facturation via un mapping automatique.

        Exemple:
            >>> cadre = CadreDeFacturation(
            ...     code_cadre_facturation=CodeCadreFacturation.A1_FACTURE_FOURNISSEUR,
            ...     nature_operation=NatureOperation.BIENS  # Force B1 au lieu de S1
            ... )
      properties:
        codeCadreFacturation:
          $ref: "#/components/schemas/CodeCadreFacturation"
        natureOperation:
          allOf:
          - $ref: "#/components/schemas/NatureOperation"
          nullable: true
        codeServiceValideur:
          nullable: true
          type: string
        codeStructureValideur:
          nullable: true
          type: string
      required:
      - codeCadreFacturation
      title: CadreDeFacturation
    CategorieTVA:
      description: |-
        Cat√©gories de TVA standardis√©es pour Factur-X (norme EN 16931).

        **Valeurs possibles :**
        - `S` : STANDARD - TVA au taux standard
        - `Z` : ZERO - TVA √† taux z√©ro
        - `E` : EXONEREE - Exon√©ration de TVA
        - `AE` : AUTO_LIQUIDATION - Auto-liquidation (reverse charge)
        - `K` : INTRA_COMMUNAUTAIRE - Livraison intracommunautaire
        - `G` : EXPORT - Export hors UE
        - `O` : HORS_CHAMP - Hors champ de la TVA
        - `L` : CANARIES - TVA Canaries
        - `M` : CEUTA_MELILLA - TVA Ceuta/Melilla
      enum:
      - S
      - Z
      - E
      - AE
      - K
      - G
      - O
      - L
      - M
      title: CategorieTVA
      type: string
      x-enum-varnames:
      - STANDARD
      - ZERO
      - EXONEREE
      - AUTO_LIQUIDATION
      - INTRA_COMMUNAUTAIRE
      - EXPORT
      - HORS_CHAMP
      - CANARIES
      - CEUTA_MELILLA
      x-enum-descriptions:
      - STANDARD - TVA au taux standard
      - ZERO - TVA √† taux z√©ro
      - EXONEREE - Exon√©ration de TVA
      - AUTO_LIQUIDATION - Auto-liquidation (reverse charge)
      - INTRA_COMMUNAUTAIRE - Livraison intracommunautaire
      - EXPORT - Export hors UE
      - HORS_CHAMP - Hors champ de la TVA
      - CANARIES - TVA Canaries
      - CEUTA_MELILLA - TVA Ceuta/Melilla
    CodeCadreFacturation:
      description: Codes Chorus Pro pour le cadre de facturation (usage B2G).
      enum:
      - A1_FACTURE_FOURNISSEUR
      - A2_FACTURE_FOURNISSEUR_DEJA_PAYEE
      - A9_FACTURE_SOUSTRAITANT
      - A12_FACTURE_COTRAITANT
      title: CodeCadreFacturation
      type: string
    CodeRaisonReduction:
      description: |-
        Codes standardis√©s pour justifier une r√©duction ou une charge suppl√©mentaire (norme EN 16931).

        **Valeurs possibles :**
        - `AA` : REMISE_PUBLICITAIRE - Remise ou rabais publicitaire
        - `ABL` : SUPPLEMENT_EMBALLAGE - Suppl√©ment d'emballage
        - `ADR` : AUTRES_SERVICES - Autres services
        - `ADT` : ENLEVEMENT - Co√ªt d'enl√®vement
        - `FC` : COUTS_TRANSPORT - Co√ªts de transport
        - `FI` : FRAIS_FINANCIERS - Frais de financement
        - `LA` : ETIQUETAGE - √âtiquetage
      enum:
      - AA
      - ABL
      - ADR
      - ADT
      - FC
      - FI
      - LA
      title: CodeRaisonReduction
      type: string
      x-enum-varnames:
      - REMISE_PUBLICITAIRE
      - SUPPLEMENT_EMBALLAGE
      - AUTRES_SERVICES
      - ENLEVEMENT
      - COUTS_TRANSPORT
      - FRAIS_FINANCIERS
      - ETIQUETAGE
      x-enum-descriptions:
      - REMISE_PUBLICITAIRE - Remise ou rabais publicitaire
      - SUPPLEMENT_EMBALLAGE - Suppl√©ment d'emballage
      - AUTRES_SERVICES - Autres services
      - ENLEVEMENT - Co√ªt d'enl√®vement
      - COUTS_TRANSPORT - Co√ªts de transport
      - FRAIS_FINANCIERS - Frais de financement
      - ETIQUETAGE - √âtiquetage
    Destinataire:
      description: Informations sur le destinataire de la facture (le client).
      properties:
        adresseElectronique:
          allOf:
          - $ref: "#/components/schemas/AdresseElectronique"
          nullable: true
        codeServiceExecutant:
          nullable: true
          type: string
        nom:
          nullable: true
          type: string
        siren:
          nullable: true
          type: string
        siret:
          nullable: true
          type: string
        adressePostale:
          allOf:
          - $ref: "#/components/schemas/AdressePostale"
          nullable: true
      required:
      - adresseElectronique
      title: Destinataire
    Fournisseur:
      description: Informations sur le fournisseur qui √©met la facture.
      properties:
        adresseElectronique:
          allOf:
          - $ref: "#/components/schemas/AdresseElectronique"
          nullable: true
        idFournisseur:
          title: Idfournisseur
          type: integer
        codeCoordonneesBancairesFournisseur:
          nullable: true
          type: integer
        idServiceFournisseur:
          nullable: true
          type: integer
        nom:
          nullable: true
          type: string
        siren:
          nullable: true
          type: string
        siret:
          nullable: true
          type: string
        numeroTvaIntra:
          nullable: true
          type: string
        iban:
          nullable: true
          type: string
        adressePostale:
          allOf:
          - $ref: "#/components/schemas/AdressePostale"
          nullable: true
      required:
      - adresseElectronique
      - idFournisseur
      title: Fournisseur
    LigneDePoste:
      description: Repr√©sente une ligne de d√©tail dans une facture.
      properties:
        numero:
          title: Numero
          type: integer
        reference:
          nullable: true
          type: string
        denomination:
          title: Denomination
          type: string
        quantite:
          $ref: "#/components/schemas/Quantite"
        unite:
          $ref: "#/components/schemas/Unite"
        montantUnitaireHt:
          $ref: "#/components/schemas/MontantUnitaireHt"
        montantRemiseHt:
          $ref: "#/components/schemas/LigneDePoste_montantRemiseHt"
        montantTotalLigneHt:
          $ref: "#/components/schemas/MontantTotalLigneHt"
        tauxTva:
          nullable: true
          type: string
        tauxTvaManuel:
          $ref: "#/components/schemas/LigneDePoste_tauxTvaManuel"
        categorieTva:
          allOf:
          - $ref: "#/components/schemas/CategorieTVA"
          nullable: true
        dateDebutPeriode:
          nullable: true
          type: string
        dateFinPeriode:
          nullable: true
          type: string
        codeRaisonReduction:
          allOf:
          - $ref: "#/components/schemas/CodeRaisonReduction"
          nullable: true
        raisonReduction:
          nullable: true
          type: string
      required:
      - denomination
      - montantUnitaireHt
      - numero
      - quantite
      - unite
      title: LigneDePoste
    LigneDeTVA:
      description: |-
        Repr√©sente une ligne de totalisation par taux de TVA.

        Pour les exon√©rations (cat√©gories E, AE, K, G, O), les champs
        `motif_exoneration` et `code_vatex` sont requis selon EN16931.
      properties:
        montantBaseHt:
          $ref: "#/components/schemas/MontantBaseHt"
        montantTva:
          $ref: "#/components/schemas/MontantTvaLigne"
        taux:
          nullable: true
          type: string
        tauxManuel:
          $ref: "#/components/schemas/Tauxmanuel"
        categorie:
          allOf:
          - $ref: "#/components/schemas/CategorieTVA"
          nullable: true
        motifExoneration:
          nullable: true
          type: string
        codeVatex:
          nullable: true
          type: string
      required:
      - montantBaseHt
      - montantTva
      title: LigneDeTVA
    ModeDepot:
      description: Mode de d√©p√¥t de la facture sur Chorus Pro.
      enum:
      - SAISIE_API
      - DEPOT_PDF_API
      - DEPOT_PDF_SIGNE_API
      title: ModeDepot
      type: string
    ModePaiement:
      description: Modes de paiement accept√©s.
      enum:
      - CHEQUE
      - PRELEVEMENT
      - VIREMENT
      - ESPECE
      - AUTRE
      - REPORT
      title: ModePaiement
      type: string
    MontantTotal:
      description: Contient tous les montants totaux de la facture.
      properties:
        montantHtTotal:
          $ref: "#/components/schemas/MontantHtTotal"
        montantTva:
          $ref: "#/components/schemas/MontantTvaTotal"
        montantTtcTotal:
          $ref: "#/components/schemas/MontantTtcTotal"
        montantAPayer:
          $ref: "#/components/schemas/MontantAPayer"
        acompte:
          $ref: "#/components/schemas/MontantTotal_acompte"
        montantRemiseGlobaleTtc:
          $ref: "#/components/schemas/MontantRemiseGlobaleTtc"
        motifRemiseGlobaleTtc:
          nullable: true
          type: string
      required:
      - montantAPayer
      - montantHtTotal
      - montantTtcTotal
      - montantTva
      title: MontantTotal
    NatureOperation:
      description: |-
        Nature de l'op√©ration (BT-23) pour Factur-X - R√©forme fran√ßaise.

        BR-FR-08: Le cadre de facturation doit √™tre l'un des codes suivants.
        La premi√®re lettre indique : B = Biens, S = Services, M = Mixte.

        Ref: XP Z12-012, article_conformite_pdf_facturx.md

        Exemple d'utilisation:
            >>> cadre = CadreDeFacturation(
            ...     code_cadre_facturation=CodeCadreFacturation.A1_FACTURE_FOURNISSEUR,
            ...     nature_operation=NatureOperation.BIENS
            ... )
      enum:
      - B1
      - S1
      - M1
      - B2
      - S2
      - M2
      - B4
      - S4
      - M4
      - S3
      - S5
      - S6
      - B7
      - S7
      title: NatureOperation
      type: string
    Note:
      description: |-
        Note de facture (IncludedNote en Factur-X).

        Les notes obligatoires pour BR-FR-05 sont :
        - PMT : Indemnit√© forfaitaire pour frais de recouvrement
        - PMD : P√©nalit√©s de retard
        - AAB : Escompte pour paiement anticip√©
      properties:
        codeSujet:
          nullable: true
          type: string
        contenu:
          title: Contenu
          type: string
      required:
      - contenu
      title: Note
    PieceJointeComplementaire:
      description: Repr√©sente une pi√®ce jointe compl√©mentaire.
      properties:
        designation:
          title: Designation
          type: string
        id:
          title: Id
          type: integer
        idLiaison:
          title: Idliaison
          type: integer
        numeroLigneFacture:
          title: Numerolignefacture
          type: integer
        type:
          title: Type
          type: string
      required:
      - designation
      - id
      - idLiaison
      - numeroLigneFacture
      - type
      title: PieceJointeComplementaire
    References:
      description: "Contient les r√©f√©rences diverses de la facture (devise, type,\
        \ etc.)."
      properties:
        deviseFacture:
          default: EUR
          title: Devisefacture
          type: string
        modePaiement:
          $ref: "#/components/schemas/ModePaiement"
        typeFacture:
          $ref: "#/components/schemas/TypeFacture"
        typeTva:
          $ref: "#/components/schemas/TypeTVA"
        numeroMarche:
          nullable: true
          type: string
        motifExonerationTva:
          nullable: true
          type: string
        numeroBonCommande:
          nullable: true
          type: string
        numeroFactureOrigine:
          nullable: true
          type: string
      required:
      - modePaiement
      - typeFacture
      - typeTva
      title: References
    TypeTVA:
      description: R√©gime de TVA.
      enum:
      - TVA_SUR_DEBIT
      - TVA_SUR_ENCAISSEMENT
      - EXONERATION
      - SANS_TVA
      title: TypeTVA
      type: string
    Unite:
      description: Enum√©ration des unit√©s de facturation
      enum:
      - PIECE
      - HEURE
      - JOUR
      - KILOGRAMME
      - LITRE
      - FORFAIT
      title: Unite
      type: string
    FactureFacturX:
      description: Mod√®le de donn√©es pour une facture destin√©e √† √™tre convertie en
        Factur-X.
      example:
        numero_facture: FACT-2025-001
        date_facture: 2025-10-27
        date_echeance_paiement: 2025-11-27
        mode_depot: DEPOT_PDF_API
        destinataire:
          nom: Client Test SAS
          adresse_electronique:
            identifiant: "12345678901234"
            scheme_id: "0225"
          adresse_postale:
            ligne_un: 456 Avenue des Champs
            code_postal: "69001"
            nom_ville: Lyon
            pays_code_iso: FR
          code_service_executant: SERVICE01
        fournisseur:
          nom: Ma Soci√©t√© SAS
          id_fournisseur: 12345
          siret: "12345678900001"
          numero_tva_intra: FR12345678900
          iban: FR7630006000011234567890189
          adresse_electronique:
            identifiant: "12345678900001"
            scheme_id: "0225"
          adresse_postale:
            ligne_un: 123 Rue de la R√©publique
            ligne_deux: B√¢timent A
            code_postal: "75001"
            nom_ville: Paris
            pays_code_iso: FR
        cadre_de_facturation:
          code_cadre_facturation: A1_FACTURE_FOURNISSEUR
        references:
          type_facture: FACTURE
          type_tva: TVA_SUR_DEBIT
          mode_paiement: VIREMENT
          devise_facture: EUR
          numero_bon_commande: CMD-2025-042
        lignes_de_poste:
        - numero: 1
          denomination: Prestation de conseil
          quantite: "5.00"
          unite: HEURE
          montant_unitaire_ht: "200.00"
          montant_ligne_ht: "1000.00"
          taux_tva_manuel: "20.00"
          categorie_tva: S
          reference: REF-CONSEIL-001
        - numero: 2
          denomination: Formation d√©veloppeurs
          quantite: "3.00"
          unite: JOUR
          montant_unitaire_ht: "500.00"
          montant_ligne_ht: "1500.00"
          categorie_tva: S
          taux_tva_manuel: "20.00"
          reference: REF-FORM-002
        lignes_de_tva:
        - montant_base_ht: "2500.00"
          montant_tva: "500.00"
          taux_manuel: "20.00"
          categorie: S
        montant_total:
          montant_ht_total: "2500.00"
          montant_tva: "500.00"
          montant_ttc_total: "3000.00"
          montant_a_payer: "3000.00"
        commentaire: Facture pour prestations du mois d'octobre 2025
      properties:
        numeroFacture:
          title: Numerofacture
          type: string
        dateEcheancePaiement:
          title: Dateecheancepaiement
          type: string
        dateFacture:
          title: Datefacture
          type: string
        modeDepot:
          $ref: "#/components/schemas/ModeDepot"
        destinataire:
          $ref: "#/components/schemas/Destinataire"
        fournisseur:
          $ref: "#/components/schemas/Fournisseur"
        cadreDeFacturation:
          $ref: "#/components/schemas/CadreDeFacturation"
        references:
          $ref: "#/components/schemas/References"
        montantTotal:
          $ref: "#/components/schemas/MontantTotal"
        lignesDePoste:
          items:
            $ref: "#/components/schemas/LigneDePoste"
          type: array
        lignesDeTva:
          items:
            $ref: "#/components/schemas/LigneDeTVA"
          type: array
        notes:
          items:
            $ref: "#/components/schemas/Note"
          type: array
        commentaire:
          nullable: true
          type: string
        idUtilisateurCourant:
          nullable: true
          type: integer
        piecesJointesComplementaires:
          items:
            $ref: "#/components/schemas/PieceJointeComplementaire"
          nullable: true
          type: array
        beneficiaire:
          allOf:
          - $ref: "#/components/schemas/Beneficiaire"
          nullable: true
      required:
      - cadreDeFacturation
      - dateEcheancePaiement
      - destinataire
      - fournisseur
      - modeDepot
      - montantTotal
      - numeroFacture
      - references
      title: FactureFacturX
    PDPCredentials:
      description: |-
        Credentials PDP pour la strat√©gie zero-storage (Strategy B).

        Permet de fournir directement les credentials PDP dans la requ√™te
        au lieu de les stocker dans Django.

        Utile pour :
        - Tests ponctuels sans persister les credentials
        - Int√©grations temporaires
        - Environnements de d√©veloppement
      example:
        client_id: factpulse_prod_abc123
        client_secret: secret_xyz789
        directory_service_url: https://api.pdp-example.fr/directory/v1
        flow_service_url: https://api.pdp-example.fr/flow/v1
        token_url: https://auth.pdp-example.fr/oauth/token
      properties:
        flow_service_url:
          description: URL de base du Flow Service AFNOR
          example: https://api.pdp-example.fr/flow/v1
          title: Flow Service Url
          type: string
        directory_service_url:
          nullable: true
          type: string
        token_url:
          description: URL du serveur OAuth2
          example: https://auth.pdp-example.fr/oauth/token
          title: Token Url
          type: string
        client_id:
          description: Client ID OAuth2
          example: factpulse_prod_abc123
          title: Client Id
          type: string
        client_secret:
          description: Client Secret OAuth2 (sensible)
          example: secret_xyz789
          title: Client Secret
          type: string
      required:
      - client_id
      - client_secret
      - flow_service_url
      - token_url
      title: PDPCredentials
    ProfilFlux:
      description: Profils de flux support√©s
      enum:
      - Basic
      - CIUS
      - Extended-CTC-FR
      title: ProfilFlux
      type: string
    SyntaxeFlux:
      description: Syntaxes de flux support√©es par AFNOR
      enum:
      - CII
      - UBL
      - Factur-X
      - CDAR
      - FRR
      title: SyntaxeFlux
      type: string
    RequeteSoumissionFlux:
      description: Requ√™te pour soumettre une facture √† une PDP/PA via AFNOR
      example:
        nom_flux: Facture 2025-001
        profil_flux: CIUS
        syntaxe_flux: CII
        tracking_id: TRACK-2025-001
      properties:
        nom_flux:
          description: "Nom du flux (ex: 'Facture 2025-001')"
          example: Facture 2025-001
          title: Nom Flux
          type: string
        syntaxe_flux:
          allOf:
          - $ref: "#/components/schemas/SyntaxeFlux"
          default: CII
          description: Syntaxe du flux (CII pour Factur-X)
        profil_flux:
          allOf:
          - $ref: "#/components/schemas/ProfilFlux"
          nullable: true
        tracking_id:
          nullable: true
          type: string
        request_id:
          nullable: true
          type: string
        pdp_credentials:
          allOf:
          - $ref: "#/components/schemas/PDPCredentials"
          nullable: true
      required:
      - nom_flux
      title: RequeteSoumissionFlux
    DirectionFlux:
      description: Direction du flux
      enum:
      - In
      - Out
      title: DirectionFlux
      type: string
    StatutAcquittement:
      description: Statut d'acquittement du flux
      enum:
      - Pending
      - Ok
      - Error
      title: StatutAcquittement
      type: string
    TypeFlux:
      description: Types de flux de facturation
      enum:
      - CustomerInvoice
      - SupplierInvoice
      - CustomerInvoiceLC
      - SupplierInvoiceLC
      - eReporting
      title: TypeFlux
      type: string
    RequeteRechercheFlux:
      description: Requ√™te pour rechercher des flux soumis
      example:
        direction_flux:
        - Out
        limit: 10
        statut_acquittement: Ok
        type_flux:
        - SupplierInvoice
      properties:
        date_maj_apres:
          format: date-time
          nullable: true
          type: string
        date_maj_avant:
          format: date-time
          nullable: true
          type: string
        type_flux:
          items:
            $ref: "#/components/schemas/TypeFlux"
          nullable: true
          type: array
        direction_flux:
          items:
            $ref: "#/components/schemas/DirectionFlux"
          nullable: true
          type: array
        tracking_id:
          nullable: true
          type: string
        flow_id:
          nullable: true
          type: string
        statut_acquittement:
          allOf:
          - $ref: "#/components/schemas/StatutAcquittement"
          nullable: true
        offset:
          default: 0
          description: D√©calage pour la pagination
          minimum: 0
          title: Offset
          type: integer
        limit:
          default: 25
          description: Nombre maximum de r√©sultats (max 100)
          maximum: 100
          minimum: 1
          title: Limit
          type: integer
      title: RequeteRechercheFlux
    ReponseSoumissionFlux:
      description: R√©ponse apr√®s soumission d'un flux
      example:
        flow_id: 550e8400-e29b-41d4-a716-446655440000
        message: ‚úì Facture soumise avec succ√®s √† la PDP/PA
        nom: Facture 2025-001
        profil_flux: CIUS
        sha256: a3c5f1...
        syntaxe_flux: CII
        tracking_id: TRACK-2025-001
      properties:
        flow_id:
          description: Identifiant unique du flux g√©n√©r√© par la PDP
          title: Flow Id
          type: string
        tracking_id:
          nullable: true
          type: string
        nom:
          description: Nom du flux
          title: Nom
          type: string
        syntaxe_flux:
          description: "Syntaxe du flux (CII, UBL, etc.)"
          title: Syntaxe Flux
          type: string
        profil_flux:
          nullable: true
          type: string
        sha256:
          description: Hash SHA256 du fichier soumis
          title: Sha256
          type: string
        message:
          description: Message de confirmation
          title: Message
          type: string
      required:
      - flow_id
      - message
      - nom
      - sha256
      - syntaxe_flux
      title: ReponseSoumissionFlux
    FluxResume:
      description: R√©sum√© d'un flux dans les r√©sultats de recherche
      properties:
        flow_id:
          title: Flow Id
          type: string
        tracking_id:
          nullable: true
          type: string
        nom:
          title: Nom
          type: string
        type_flux:
          nullable: true
          type: string
        direction_flux:
          nullable: true
          type: string
        statut_acquittement:
          nullable: true
          type: string
        date_creation:
          nullable: true
          type: string
        date_maj:
          nullable: true
          type: string
      required:
      - flow_id
      - nom
      title: FluxResume
    ReponseRechercheFlux:
      description: R√©ponse d'une recherche de flux
      example:
        limit: 25
        offset: 0
        resultats:
        - direction_flux: Out
          flow_id: 550e8400-e29b-41d4-a716-446655440000
          nom: Facture 2025-001
          statut_acquittement: Ok
          tracking_id: TRACK-2025-001
          type_flux: SupplierInvoice
        total: 42
      properties:
        total:
          description: Nombre total de r√©sultats
          title: Total
          type: integer
        offset:
          description: D√©calage appliqu√©
          title: Offset
          type: integer
        limit:
          description: Limite de r√©sultats
          title: Limit
          type: integer
        resultats:
          description: Liste des flux trouv√©s
          items:
            $ref: "#/components/schemas/FluxResume"
          type: array
      required:
      - limit
      - offset
      - resultats
      - total
      title: ReponseRechercheFlux
    ReponseHealthcheckAFNOR:
      description: R√©ponse du healthcheck des services AFNOR
      example:
        directory_service_ok: true
        flow_service_ok: true
        message: ‚úì Services AFNOR op√©rationnels
      properties:
        flow_service_ok:
          description: √âtat du Flow Service API
          title: Flow Service Ok
          type: boolean
        directory_service_ok:
          description: √âtat du Directory Service API
          title: Directory Service Ok
          type: boolean
        message:
          description: Message descriptif de l'√©tat
          title: Message
          type: string
      required:
      - directory_service_ok
      - flow_service_ok
      - message
      title: ReponseHealthcheckAFNOR
    TypeFacture:
      description: |-
        Type de document selon BR-FR-04 (codes UNTDID 1001).

        | Code | Nom | Description |
        |------|-----|-------------|
        | 380 | FACTURE | Facture commerciale |
        | 389 | FACTURE_AUTOFACTUREE | Facture auto-factur√©e |
        | 393 | FACTURE_AFFACTUREE | Facture affactur√©e |
        | 501 | FACTURE_AUTOFACTUREE_AFFACTUREE | Facture auto-factur√©e affactur√©e |
        | 386 | FACTURE_ACOMPTE | Facture d'acompte |
        | 500 | FACTURE_ACOMPTE_AUTOFACTUREE | Facture d'acompte auto-factur√©e |
        | 384 | FACTURE_RECTIFICATIVE | Facture rectificative |
        | 471 | FACTURE_RECTIFICATIVE_AUTOFACTUREE | Facture rectificative auto-factur√©e |
        | 472 | FACTURE_RECTIFICATIVE_AFFACTUREE | Facture rectificative affactur√©e |
        | 473 | FACTURE_RECTIFICATIVE_AUTOFACTUREE_AFFACTUREE | Facture rectificative auto-factur√©e affactur√©e |
        | 381 | AVOIR | Avoir |
        | 261 | AVOIR_AUTOFACTURE | Avoir auto-factur√© |
        | 262 | AVOIR_REMISE_GLOBALE | Avoir pour remise globale |
        | 396 | AVOIR_AFFACTURE | Avoir affactur√© |
        | 502 | AVOIR_AUTOFACTURE_AFFACTURE | Avoir auto-factur√© affactur√© |
        | 503 | AVOIR_ACOMPTE | Avoir de facture d'acompte |
      enum:
      - "380"
      - "389"
      - "393"
      - "501"
      - "386"
      - "500"
      - "384"
      - "471"
      - "472"
      - "473"
      - "381"
      - "261"
      - "262"
      - "396"
      - "502"
      - "503"
      title: TypeFacture
      type: string
      x-enum-varnames:
      - FACTURE
      - FACTURE_AUTOFACTUREE
      - FACTURE_AFFACTUREE
      - FACTURE_AUTOFACTUREE_AFFACTUREE
      - FACTURE_ACOMPTE
      - FACTURE_ACOMPTE_AUTOFACTUREE
      - FACTURE_RECTIFICATIVE
      - FACTURE_RECTIFICATIVE_AUTOFACTUREE
      - FACTURE_RECTIFICATIVE_AFFACTUREE
      - FACTURE_RECTIFICATIVE_AUTOFACTUREE_AFFACTUREE
      - AVOIR
      - AVOIR_AUTOFACTURE
      - AVOIR_REMISE_GLOBALE
      - AVOIR_AFFACTURE
      - AVOIR_AUTOFACTURE_AFFACTURE
      - AVOIR_ACOMPTE
      x-enum-descriptions:
      - Facture commerciale
      - Facture auto-factur√©e
      - Facture affactur√©e
      - Facture auto-factur√©e affactur√©e
      - Facture d'acompte
      - Facture d'acompte auto-factur√©e
      - Facture rectificative
      - Facture rectificative auto-factur√©e
      - Facture rectificative affactur√©e
      - Facture rectificative auto-factur√©e affactur√©e
      - Avoir
      - Avoir auto-factur√©
      - Avoir pour remise globale
      - Avoir affactur√©
      - Avoir auto-factur√© affactur√©
      - Avoir de facture d'acompte
    generer_facture_api_v1_traitement_generer_facture_post_request:
      $ref: "#/components/schemas/Body_generer_facture_api_v1_traitement_generer_facture_post"
    Destination:
      description: Configuration de la destination (Chorus Pro ou AFNOR)
      discriminator:
        mapping:
          afnor: "#/components/schemas/DestinationAFNOR"
          chorus_pro: "#/components/schemas/DestinationChorusPro"
        propertyName: type
      oneOf:
      - $ref: "#/components/schemas/DestinationChorusPro"
      - $ref: "#/components/schemas/DestinationAFNOR"
      title: Destination
    Montant_Ht_Total:
      anyOf:
      - type: number
      - pattern: "^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"
        type: string
      description: Montant HT total
      title: Montant Ht Total
    Montant_Tva:
      anyOf:
      - type: number
      - pattern: "^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"
        type: string
      description: Montant TVA
      title: Montant Tva
    Montant_Ttc_Total:
      anyOf:
      - type: number
      - pattern: "^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"
        type: string
      description: Montant TTC total
      title: Montant Ttc Total
    ValidationError_loc_inner:
      anyOf:
      - type: string
      - type: integer
    Quantite:
      anyOf:
      - type: number
      - pattern: "^(?!^[-+.]*$)[+-]?0*(?:\\d{0,8}|(?=[\\d.]{1,13}0*$)\\d{0,8}\\.\\\
          d{0,4}0*$)"
        type: string
      description: Quantit√© factur√©e pour cette ligne.
      title: Quantite
    MontantUnitaireHt:
      anyOf:
      - type: number
      - pattern: "^(?!^[-+.]*$)[+-]?0*(?:\\d{0,8}|(?=[\\d.]{1,13}0*$)\\d{0,8}\\.\\\
          d{0,4}0*$)"
        type: string
      description: Montant unitaire Hors Taxes de l'article.
      title: MontantUnitaireHt
    LigneDePoste_montantRemiseHt:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Montant de la remise HT. (Accepte number, string ou integer)"
      format: decimal
      nullable: true
    MontantTotalLigneHt:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Montant total HT de la ligne (quantit√© √ó prix unitaire - remise).\
        \ (Accepte number, string ou integer)"
      format: decimal
      title: MontantTotalLigneHt
    LigneDePoste_tauxTvaManuel:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Taux de TVA avec valeur manuelle. (Accepte number, string ou integer)"
      format: decimal
      nullable: true
    MontantBaseHt:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Montant de la base HT pour cette ligne de TVA. (Accepte number,\
        \ string ou integer)"
      format: decimal
      title: MontantBaseHt
    MontantTvaLigne:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Montant de la TVA pour cette ligne. (Accepte number, string ou\
        \ integer)"
      format: decimal
      title: MontantTvaLigne
    Tauxmanuel:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Taux de TVA avec valeur manuelle. (Accepte number, string ou integer)"
      format: decimal
      title: Tauxmanuel
    MontantHtTotal:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Montant total HT. (Accepte number, string ou integer)"
      format: decimal
      title: MontantHtTotal
    MontantTvaTotal:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Montant total de la TVA. (Accepte number, string ou integer)"
      format: decimal
      title: MontantTvaTotal
    MontantTtcTotal:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Montant total TTC. (Accepte number, string ou integer)"
      format: decimal
      title: MontantTtcTotal
    MontantAPayer:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Montant √† payer. (Accepte number, string ou integer)"
      format: decimal
      title: MontantAPayer
    MontantTotal_acompte:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Acompte vers√©. (Accepte number, string ou integer)"
      format: decimal
      nullable: true
    MontantRemiseGlobaleTtc:
      anyOf:
      - minimum: 0.0
        type: number
      - pattern: "^-?\\d+(\\.\\d{1,4})?$"
        type: string
      description: "Montant de la remise globale TTC. (Accepte number, string ou integer)"
      format: decimal
      title: MontantRemiseGlobaleTtc
  securitySchemes:
    HTTPBearer:
      scheme: bearer
      type: http

